var aliMetrics=function(){"use strict";var e="",n={};function i(){return document.cookie===e?n:(e=document.cookie,n=e.split(";").reduce(function(e,n){var i=n.split("=");return e[i[0].trim()]=i[1],e},{}))}var t={jpg:"image",jpeg:"image",gif:"image",ico:"image",png:"image",bmp:"image",webp:"image",svg:"image",ai:"image",eps:"image",ttf:"font",otf:"font",woff:"font",woff2:"font",eot:"font"};function o(){return function(e,n){var i,o=function(e){return t[e]||e}((i=n.name,(/\.[\w\d]+([\?#]|$)/.exec(i)||["unidentified"])[0].replace(/[\.\?\#]/g,"").toLowerCase())),r=n.decodedBodySize,a=e[o]=e[o]||{count:0,totalBytes:0,notMeasured:0};return a.count+=1,r?a.totalBytes+=r:a.notMeasured+=1,e}}var r=["string","number"],a={},s=void 0!==window.navigator&&(navigator.connection||navigator.mozConnection||navigator.webkitConnection)||{};function c(){var e,n={};for(e in s)r.indexOf(typeof s[e])>-1&&(n[e]=s[e]);a=n}function d(){return a}s.addEventListener?s.addEventListener("change",c):s.onchange=c,c();var u={},l="";function f(){var e;return e=i().axplocale||(location.search===l?u:(l=location.search,u=l.replace(/^\?+/,"").split("&").reduce(function(e,n){var i=n.split("=");return e[i[0].trim()]=i[1],e},{}))).face||navigator.language||navigator.userLanguage,{screen:{width:screen.width,height:screen.height},locale:e,location:location.href,userAgent:navigator.userAgent}}var m={E0:{xhr:"https://api.dev.americanexpress.com/servicing/v1/laas/logs",beacon:"https://laas-dev.aexp.com/v1/log"},E1:{xhr:"https://api.dev.americanexpress.com/servicing/v1/laas/logs",beacon:"https://laas-dev.aexp.com/v1/log"},E2:{xhr:"https://api.qa.americanexpress.com/servicing/v1/laas/logs",beacon:"https://laas-qa.americanexpress.com/v1/log"},E3:{xhr:"https://apigateway.americanexpress.com/servicing/v1/laas/logs",beacon:"https://laas.americanexpress.com/v1/log"}},p={E0:"6GfgUwicMl4A7jKFQvyfSzlgbZQy0S6T",E1:"6GfgUwicMl4A7jKFQvyfSzlgbZQy0S6T",E2:"9wrZ21GfU3k0AeYib6AOm4R5UAEqySeV",E3:"kjEvlYexaMvoUrWTbGm1fXS28Qj6QE1V"};var g,w={dev:"E1",qa:"E2",undefined:"E3"};var h,v,y,x,E,S,b=function(e){return"ios"===e?"IOS":e.indexOf("ipad")>=0?"IPad":e.indexOf("Android")>=0?"Android":e.indexOf("CrOS")>=0?"Chromium OS":e.indexOf("Edge")>=0?"Edge":e.indexOf("Trident/7.0")>=0?"IE 11":e.indexOf("MSIE 10")>=0?"IE 10":e.indexOf("MSIE 9")>=0?"IE 9":e.indexOf("IEMobile")>=0?"IE Mobile":e.indexOf("MSIE")>=0?"4IE 8 or Below":e.indexOf("Firefox")>=0?"Firefox":e.indexOf("iPhone")>=0?"OSiPhone":e.indexOf("Chrome")>=0?"Chrome":e.indexOf("Safari")>=0?"Safari":"Others"}(navigator.userAgent),O="one-amex-myca",T="OneAmex",M=g||(h=f(),g=[h.userAgent,h.screen.width,h.screen.height,JSON.stringify(d()),Date.now(),Math.random()].join("-"));try{y=function(){var e,n=location.hostname;if(!/americanexpress.com$/.test(n))return"E0";if(e=n.split(".").shift(),!/global(\d*)?$/.test(e)){const n=(e=e.split("-")).length>1&&e.pop()||void 0;return[w[String(n)],"epaas",e.join("-")].join("_").toUpperCase()}return e.replace("global","").replace(/q(\d+)$/,function(e){return e.replace("q","_g")}).replace(/q$/,"_qa").replace(/^sl/,"e3_sl").replace(/^$/,"e3_prod").toUpperCase()}(),E=function(e){return m[e]}(y.substr(0,2)),x=function(e){return p[e]}(y.substr(0,2))}catch(e){}try{v=document.currentScript||document.querySelector("script[data-ali-project]"),T=v.getAttribute("data-ali-project")||T,O=v.getAttribute("data-ali-portfolio")||O}catch(e){}function L(e,n,t,r,a,s,c){var u,l,m,p=i().blueboxpublic||"NA",g=f(),w=s||location.pathname,h=c||location.href,v=a||0,S=g.userAgent;e.resourcesSummary=(e.resources||[]).reduce(o(),{}),e.client={screen:g.screen,network:d()};const L=JSON.stringify({type:"REPORT",version:"1.0.0",timestamp:new Date(Date.now()).toISOString(),correlationId:M,environment:{name:y,containerType:"BROWSER"},application:{project:T,portfolio:O,name:w,type:"WEB_APP"},headers:{url:h,referrerUrl:document.referrer,locale:g.locale,userAgent:S,httpStatusCode:200,responseSize:0,publicGuid:p,browser:b},functionName:"RUM",status:r||"Success",responseTime:v,message:t||"resources load metrics",additionalFields:e});if(l={"x-amex-api-key":x,"x-amex-request-id":M},navigator&&navigator.sendBeacon&&E.beacon)navigator.sendBeacon(E.beacon,L);else if(n||"undefined"==typeof fetch){const e=new XMLHttpRequest;for(m in e.open("POST",E.xhr,!n),l)e.setRequestHeader(m,l[m]);e.send(L)}else u={method:"POST",mode:"cors",cache:"default",headers:l,body:L},fetch(E.xhr,u)}function A(e){return e}function k(){return!0}function C(e,n,i,t,o,r){var a=r||[],s=t||e.length,c=o||S,d=c.inList||[];if(window.derp=d,i>=s)return n(a);(c.filter||k)(e[i])&&function(e){if(!d.includes(e.name))return d.push(e.name),e}(e[i])&&a.push((c.map||A)(e[i])),c.inList=d,setTimeout(function(){C(e,n,i+1,s,c,a)})}S={map:A,filter:k};var I=0,j=0,q=[];function B(e){return/^(rum-marker--)/.test(e.name)}function R(e){var n=e.name.split("--");return{component:n[1],operation:n[2],startTime:e.startTime}}function U(e){if(!q.includes(e.name))return q.push(e.name),e}function P(e,n,i){var t,o,r,a,s,c=I,d=j,u=2,l=i||window.performance,f={timings:{historyChangeTime:window.aliMetrics.historyChangeTime}};function m(e,n){f[e]=n,f.moduleLoadTimes=window.moduleLoadTimes?window.moduleLoadTimes:{},(u-=1)||L(f,void 0,void 0,void 0,void 0,a,s)}try{for(t in l.timing)"number"==typeof l.timing[t]&&(f.timings[t]=l.timing[t]);f.navigation=l.navigation.toJSON()||{},o=l.getEntriesByType("resource"),r=l.getEntriesByType("mark"),a=n||location.pathname,s=location.href,e?(r=r.slice(d).filter(B).map(R).filter(U),L({resources:o.slice(c),marks:r,client:void 0,moduleLoadTimes:window.moduleLoadTimes?window.moduleLoadTimes:{},timings:f.timings,navigation:f.navigation},e,void 0,void 0)):(C(o,function(e){m("resources",e)},c),C(r,function(e){m("marks",e)},d,void 0,{filter:B,map:R})),I=o.length,j=r.length}catch(n){L({stack:n.stack},e,n.message,"UserException")}return 0}function N(e){var n,i={};function t(n){window.history[n]=function(){return P(!0),window.aliMetrics.historyChangeTime=e.now(),window.aliMetrics.paintingTime=void 0,i[n].apply(window.history,arguments)}}if(window.history)for(n in i={back:window.history.back,forward:window.history.forward,go:window.history.go,pushState:window.history.pushState,replaceState:window.history.replaceState})t(n)}var z=0;function Q(e){return function(){z=Math.ceil(1.2*(z||e.getEntriesByType("resource").length)),e.setResourceTimingBufferSize(z)}}var $={};function _(){var e=window.performance;N(e),e.addEventListener?e.addEventListener("resourcetimingbufferfull",Q(e)):e.onresourcetimingbufferfull=Q(e)}return"undefined"!=typeof window&&!window.aliMetrics&&window.performance?($={log:function(e,n,i,t){return L(e||{},t,n,i)},logResources:function(e,n){return P(n,e)}},document.body&&(window.aliMetrics=$,new MutationObserver(function(e){e.forEach(function(e){var n,i,t,o;if("childList"===e.type)for(n=performance.now(),i=0;i<e.addedNodes.length;i++)(o=(t=e.addedNodes[i]).matches||t.msMatchesSelector)&&o.call(t,'[data-module-name="axp-dynamic-layout"]>div.row:nth-child(2)')&&(window.aliMetrics.paintingTime=n,document.readyState)})}).observe(document.body,{childList:!0,subtree:!0})),"complete"===document.readyState?_():window.addEventListener("load",_),window.addEventListener("unload",function(){N(window.performance),P(!0)})):"undefined"!=typeof window&&window.aliMetrics&&($=window.aliMetrics),$}();

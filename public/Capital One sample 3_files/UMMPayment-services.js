define(["angular"],function(e){var t=e.module("UMMPaymentModule");return t.factory("UmmPaymentFactory",["$state","EaseConstant","EASEUtilsFactory","$q","Restangular","EaseConstantFactory","easeExceptionsService","$ocLazyLoad","$injector","pubsubService","summaryService","i18nContent",function(e,t,n,a,s,r,o,c,u,i,m,l){var f,d,g,y,v=null,U=null,p=!1,E=null,S=0,A=null;return{setSuccessType:function(t){y=t.templateValue,e.go("AddExtAccSuccessState")},invokeCustomSnagPubSub:function(e){i.pageView({levels:["error"],otherProps:{name:e.displayMessage,error:e.errorIdString}},!0)},getSuccessType:function(){return y},getSelectedIdx:function(e){if(null==S)for(var t=this.getData(e),n=0;n<t.length;n++){var a=t[n];a.referenceId===A&&(S=n)}return S},isDataChanged:function(){return p},setUmmData:function(e){null!=v&&(p=!p),v=e},getUmmData:function(){return v},getData:function(e){return"accountDd"===e?v.availableAccounts:"amountDd"===e?v.availableAmounts:void 0},setSuccessData:function(e){E=e},getSuccessData:function(){return E},setAccItem:function(e){U=e},getAccItem:function(){return U},getLob:function(e){for(var n in t.lineOfBusiness)if(t.lineOfBusiness[n]===e)return n},isOtherAmountValid:function(e){var t=/\d*\.?\d\d?/g,n=parseFloat(t.exec(e));return isNaN(n)?{success:!1,message:"is required"}:n>1e5?{success:!1,message:"(< $100,000)"}:{success:!0}},getUmmPaymentInfo:function(e,t){var n=a.defer(),c=this.getLob(e)+"/UmmPayments/"+encodeURIComponent(t)+"/";s.setBaseUrl(r.baseUrl());var u=s.all(c);return u.get("").then(function(e){n.resolve(e)},function(e){throw n.reject(),o.createEaseException({module:"UMMPaymentModule","function":"UMMPaymentService.getUmmPaymentInfo",message:e.statusText,cause:e})}),n.promise},getUmmPayment:function(e){A=e.accountRefId;var t=this,a=this.getLob(e.category)+"/UmmPayments/"+encodeURIComponent(e.accountRefId)+"/";return s.setBaseUrl(r.baseUrl()),e.header?n.setCustomerActivityHeader(e.header):n.setCustomerActivityHeader("50013"),s.all(a).get("",{}).then(function(n){t.setUmmData(n),t.setAccItem(e)},function(e){throw o.createEaseException({module:"UMMPaymentModule","function":"UMMPaymentService.getUmmPaymentInfo",message:e.statusText,cause:e})})},getNewAvailableAmounts:function(e,t){var n=a.defer(),c=this.getLob(e)+"/UmmPayments/"+encodeURIComponent(t)+"/getNewAvailableAmounts";s.setBaseUrl(r.baseUrl());var u=s.all(c);return u.get("").then(function(e){n.resolve(e)},function(e){throw n.reject(),o.createEaseException({module:"UMMPaymentModule","function":"UMMPaymentService.getNewAvailableAmounts",message:e.statusText,cause:e})}),n.promise},getUmmPaymentModal:function(e,t){function n(e){o.displayErrorHandler(e.msgHeader,e.msgBody),stopSpinner()}switch(e.category){case"AL":var a=["js!AutoLoan"];this.getLobUmmPayment(e,t.payment.isAccountDataAvailable,"autoLoanModuleService",a,t.payment.stopSpinner,n,t.payment.refreshAccountSummary);break;case"CC":var a=["js!StatementModule","js!CreditCard"];this.getLobUmmPayment(e,t.payment.isAccountDataAvailable,"CC",a,t.payment.stopSpinner,n,t.payment.refreshAccountSummary);break;default:o.displayErrorHandler()}},getLobUmmPayment:function(e,t,n,a,s,r,o){c.load(a).then(function(a){var c=u.get(n);c.launchUmmPayment(e,t,s,r,o)})},populateAccountTypeValues:function(){return[{display:l["ease.common.moneymarket"],value:"MONEY_MARKET",accountUseDescription:"CONSUMER"},{display:l["ease.common.personalchecking"],value:"CHECKING",accountUseDescription:"CONSUMER"},{display:l["ease.common.personalsavings"],value:"SAVINGS",accountUseDescription:"CONSUMER"},{display:l["ease.common.businesschecking"],value:"CHECKING",accountUseDescription:"BUSINESS"},{display:l["ease.common.businesssavings"],value:"SAVINGS",accountUseDescription:"BUSINESS"}]},setBankName:function(e){f=e},getBankName:function(){return f},setContentOneData:function(e){d=e},getContentOneData:function(){return d},setFeatToggleData:function(e){g=e},getFeatToggleData:function(){return g},getBankDetails:function(e,c){var u=a.defer(),i={};c&&(i={disableErrorInterceptor:!0});var m=t.kbankDetailsUrl+e;n.setCustomerActivityHeader("50042"),s.setBaseUrl(r.baseUrl());var l=s.all(m);return l.customGET("",{},i).then(function(e){u.resolve(e)},function(e){throw u.reject(),o.createEaseException({module:"UMMPaymentModule","function":"UMMPaymentService.getBankDetails",message:e.statusText,cause:e})}),u.promise},saveExternalAccount:function(e,c,u){var i=a.defer(),m={};n.setCustomerActivityHeader(c),s.setBaseUrl(r.baseUrl()),u&&(m={disableErrorInterceptor:!0});var l=e.isTransferAccount?s.all(t.kAddExtBankUrlTransfers):s.all(t.kAddExtBankUrlPayments);return l.customPOST(e,void 0,void 0,m).then(function(e){i.resolve(e)},function(e){throw i.reject(),o.createEaseException({module:"UMMPaymentModule","function":"UMMPaymentService.saveExternalAccount",message:e.statusText,cause:e})}),i.promise},putExternalAccount:function(e){var a=t.kSaveExternalUrl;s.setBaseUrl(r.baseUrl());var c=s.all(a),u={BUS_EVT_ID:t.busEvtId.settings.putExternalAccount,EVT_SYNCH_TOKEN:n.getSyncId()};return c.customPOST(e,"",{},u).then(function(e){return e},function(e){throw o.createEaseException({module:"UMMPaymentModule","function":"UMMPaymentService.putExternalAccount",message:e.statusText,cause:e})})},focusElement:function(e){return document.getElementById(e).focus()},isPaymentsAndTransfersAccount:function(e){return"transfersAndPayments"===e}}}]),t});
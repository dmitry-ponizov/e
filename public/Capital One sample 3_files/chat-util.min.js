/*@build: chat-1.7.7
 * 24/7 Customer, Inc. Confidential, Do Not Distribute. This is an
 * unpublished, proprietary work which is fully protected under
 * copyright law. This code may only be used pursuant to a valid
 * license from 24/7 Customer, Inc.
 */
!function(){/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
var a,b,c;!function(d){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if("."===(m=a[k]))a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if((e=o[n.slice(0,l).join("/")])&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,b){return function(){return n.apply(d,v.call(arguments,0).concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var b=r[a];delete r[a],t[a]=!0,m.apply(d,b)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return void 0!==b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,b,c,f){var h,k,l,m,n,s,u=[],v=typeof c;if(f=f||a,"undefined"===v||"function"===v){for(b=!b.length&&c.length?["require","exports","module"]:b,n=0;n<b.length;n+=1)if(m=o(b[n],f),"require"===(k=m.f))u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=c?c.apply(q[a],u):void 0,a&&(h&&h.exports!==d&&h.exports!==q[a]?q[a]=h.exports:l===d&&s||(q[a]=l))}else a&&(q[a]=c)},a=b=n=function(a,b,c,e,f){if("string"==typeof a)return p[a]?p[a](b):j(o(a,b).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!b)return;b.splice?(a=b,b=c,c=null):a=d}return b=b||function(){},"function"==typeof c&&(c=e,e=f),e?m(d,a,b,c):setTimeout(function(){m(d,a,b,c)},4),n},n.config=function(a){return n(a)},a._defined=q,c=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("almond",function(){}),c("extend",[],function(){var a=function(b){if(!b||"object"!=typeof b)return b;for(var c=arguments.length,d=1;d<c;d++){var e=arguments[d];if(e&&"object"==typeof e)for(var f in e)e.hasOwnProperty(f)&&(e[f]&&e[f].constructor&&e[f].constructor===Object?(b[f]=b[f]||{},a(b[f],e[f])):b[f]=e[f])}return b};return a}),c("assert-base",["extend"],function(a){var b=/^\s*$/,c=function(){};return a(c.prototype,{assert:function(a,b){b||(b="assert failed"),a||this.onFailure(b)},isObject:function(a,b){var c=b?b+" is not an object":"object expected";this.assert("object"==typeof a&&null!==a,c)},isBoolean:function(a,b){var c=b?b+" is not a boolean":"boolean expected";this.assert("boolean"==typeof a,c)},isFunction:function(a,b){var c=b?b+" is not a function":"function expected";this.assert("function"==typeof a,c)},isNumber:function(a,b){var c=b?b+" is not a number":"number expected";this.assert("number"==typeof a,c)},notEmpty:function(a,c){var d=c?c+" is not a string or is empty":"non-empty string expected";this.assert("string"==typeof a&&!b.test(a),d)},instanceOf:function(a,b,c){var d=c?"expected instance of "+c:"unexpected instance type";this.assert(a instanceof b,d)},isScalar:function(a,b){var c=typeof a;this.assert("string"===c||"number"===c||"boolean"===c,b+" must be string, number, or boolean"),"string"===c&&this.notEmpty(a,b)},isArray:function(a,b){var c=b?b+"is not an array":"array expected";this.assert("[object Array]"===Object.prototype.toString.call(a),c)},onFailure:function(a){throw a}}),c}),c("assert",["assert-base","extend"],function(a,b){var c=function(){};return b(c.prototype,a.prototype),new c}),c("assert-weak",["assert-base","extend"],function(a,b){var c=function(){};return b(c.prototype,a.prototype,{onFailure:function(a){}}),new c}),c("browser",["module"],function(a){var b=a.config(),c=function(){},d=navigator.userAgent;if(!window.location.origin){var e=window.location.port,f="";e&&"80"!==e&&"443"!==e&&(f=":"+e),window.location.origin=window.location.protocol+"//"+window.location.hostname+f}window.console||(window.console={log:c,debug:c,warn:c,error:c}),window.onbeforeunload||(window.onbeforeunload=c),document.head||(document.head=document.getElementsByTagName("head")[0]);var g=function(){for(var a=3,b=document.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="\x3c!--[if gt IE "+ ++a+"]><i></i><![endif]--\x3e",c[0];);return a>4?a:void 0},h=/.*Trident.*rv:(\d+)/,i=/Edge\/(\d+)\./,j=function(){var a,b=h.exec(d);return b&&(a=parseInt(b[1],10)),b=i.exec(d),b&&(a=parseInt(b[1],10)),a},k=function(){return g()||(window.ActiveXObject?10:j())}();k&&k<=8&&b.addIEClassToDocument&&(document.documentElement.className+="ie"+k);var l,m;return/Safari\/([0-9.]+)/.test(d)&&(l=RegExp.$1),/Chrome\/([0-9.]+)/.test(d)&&(m=RegExp.$1,l=void 0),function(){function a(a){if(a.Event.prototype.preventDefault||(a.Event.prototype.preventDefault=function(){this.returnValue=!1}),a.Event.prototype.stopPropagation||(a.Event.prototype.stopPropagation=function(){this.cancelBubble=!0}),!a.Element.prototype.addEventListener){var b=[],c=function(c,d){var e=this,f=function(a){a.target=a.srcElement,a.currentTarget=e,d.handleEvent?d.handleEvent(a):d.call(e,a)};if("DOMContentLoaded"==c){var g=function(b){"complete"==a.document.readyState&&f(b)};if(a.document.attachEvent("onreadystatechange",g),b.push({object:this,type:c,listener:d,wrapper:g}),"complete"==a.document.readyState){var h=new a.Event;h.srcElement=a,g(h)}}else this.attachEvent("on"+c,f),b.push({object:this,type:c,listener:d,wrapper:f})},d=function(a,c){for(var d=0;d<b.length;){var e=b[d];if(e.object==this&&e.type==a&&e.listener==c){"DOMContentLoaded"==a?this.detachEvent("onreadystatechange",e.wrapper):this.detachEvent("on"+a,e.wrapper),b.splice(d,1);break}++d}};a.Element.prototype.addEventListener=c,a.Element.prototype.removeEventListener=d,a.HTMLDocument&&(a.HTMLDocument.prototype.addEventListener=c,a.HTMLDocument.prototype.removeEventListener=d),a.Window&&(a.Window.prototype.addEventListener=c,a.Window.prototype.removeEventListener=d)}}if(a(window),window!==window.parent)try{a(window.parent)}catch(b){}}(),function(){Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null===this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;d<f;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}})}(),function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null===this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(Math.abs(f)===1/0&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);c<e;){if(c in d&&d[c]===a)return c;c++}return-1})}(),function(){function a(a){this.message=a}var b="undefined"!=typeof exports?exports:this,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.prototype=new Error,a.prototype.name="InvalidCharacterError",b.btoa||(b.btoa=function(b){for(var d,e,f=String(b),g=0,h=c,i="";f.charAt(0|g)||(h="=",g%1);i+=h.charAt(63&d>>8-g%1*8)){if((e=f.charCodeAt(g+=.75))>255)throw new a("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");d=d<<8|e}return i}),b.atob||(b.atob=function(b){var d=String(b).replace(/=+$/,"");if(d.length%4==1)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var e,f,g=0,h=0,i="";f=d.charAt(h++);~f&&(e=g%4?64*e+f:f,g++%4)?i+=String.fromCharCode(255&e>>(-2*g&6)):0)f=c.indexOf(f);return i})}(),{ieVersion:k,safariVersion:l,chromeVersion:m}}),c("utils",["assert","browser","extend"],function(a,b,c){function d(){function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return(a()+a()+"-"+a()+"-4"+a().substr(0,3)+"-"+a()+"-"+a()+a()+a()).toLowerCase()}function e(a,b){return Math.floor(Math.random()*(b-a+1))+a}function f(a,b,c){return a+(new Date).getTime()+"r"+e(b,c)}function g(a){var b,c,d="+",e=0;return a&&(d=a.charAt(0),b=parseInt(a.substring(1,3),10),c=parseInt(a.substring(4,6),10),e=60*b+c),d+e}function h(a){32==a.keyCode&&this.click()}function i(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.returnValue=!1}function j(a,b){if(!a)return window;try{for(var c=b||window,d=a.split("."),e=0;e<d.length;e++)c=c[d[e]];return c}catch(f){}}function k(a,b,c){try{var d=a.split("."),e=d.pop(),f=j(d.join("."),b),g=f[e];if("function"!=typeof g)return;return c?g.bind(f):g}catch(h){}}function l(a){for(var b=a.length,c=0;c<b;c++)a[c].addEventListener("keyup",h)}function m(a){for(var b=a.length,c=0;c<b;c++)a[c].removeEventListener("keyup",n)}var n=function(){},o=/^([a-z0-9.+-]+:)/i,p=/(https?:)\/\/([^\/]+)(\/.*)*$/i,q=/(https?:\/\/[^\/]+)(?:\/.*)*$/i,r=/^\s*$/,s=/\/(?!.*\/).*/,t=function(a,b,c,d,e){var f=!1;if(null===b&&(b=n),c.getElementById(d.id))b();else{var g=document.createElement("script");g.id=d.id,g.async=!0,g.src=a,g.type="text/javascript",c.getElementsByTagName("head")[0].appendChild(g);var h;g.onload=g.onreadystatechange=function(){f||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(f=!0,clearTimeout(h),b(),g.onload=g.onreadystatechange=null)},e&&(h=setTimeout(function(){g.onload=g.onreadystatechagne=null,b({status:"timeout"})},e))}},u=function(a,b,c){return c=c||"0",a+="",a.length>=b?a:new Array(b-a.length+1).join(c)+a},v=function(a){return null===a||void 0===a},w=function(a){return v(a)?a:window.atob(a)},x=function(a){return v(a)?a:window.btoa(a)},y=function(){try{return window.self!==window.top}catch(a){return!0}},z=function(){return!!window.opener},A=function(){return!(window.opener||!this.isIFrame())},B=function(){try{var a=w(window.name.replace(/_a/g,"+").replace(/_b/g,"/").replace(/_c/g,"="));return JSON.parse(a)}catch(b){}},C=function(a){try{var b=JSON.stringify(a);return x(b).replace(/\+/g,"_a").replace(/\//g,"_b").replace(/=/g,"_c")}catch(c){}},D=function(b){a.notEmpty(b,"url");var c=window.location;return o.test(b)?b:/^\/\/.+/.test(b)?c.protocol+b:/^\/.+/.test(b)?c.origin+b:c.origin+c.pathname.replace(/\/[^\/]+$/,"/")+b},E=function(b){a.assert(b,"url");var c;if(b.protocol&&b.hostname){if(!(c=b.origin)){var d=b.port,e="";d&&"80"!==d&&"443"!==d&&(e=":"+d),c=b.protocol+"//"+b.hostname+e}}else a.notEmpty(b,"url"),c=D(b).replace(q,"$1");return c},F=function(b){a.isObject(b,"urlObj"),a.notEmpty(b.origin,"urlObj.origin");var c=[b.origin];return b.pathname&&c.push(b.pathname),b.search&&c.push(b.search),b.hash&&c.push(b.hash),c.join("")},G=function(b){a.notEmpty(b,"url"),b=D(b);var c=p.exec(b);if(!c)return{};var d=c[1],e=c[2],f=e.split(":");if(r.test(f[0]))return{};var g,h="",i="",j="";if(c[3]){var k=c[3].split("?");if(k.length>1)j=k[0],g=k[1].split("#"),h="?"+g[0],g.length>1&&(i="#"+g[1]);else{var l=c[3].split("#");j=l[0],l.length>1&&(i="#"+l[1])}}var m=function(a){return a},n=function(b,c,d,e,f){a.isObject(d,"params"),a.assert(void 0===e||"string"==typeof e&&1===e.length,"invalid delim"),a.assert(void 0===f||"boolean"==typeof f,"invalid encodeParams value"),e=e||"&";var g=f?encodeURIComponent:m,h=(this.hash,[]);b.length&&h.push(b.substring(1));for(var i in d)h.push(i+"="+(void 0===i?"":g(d[i])));return c+h.join(e)};return{protocol:d,host:e,hostname:f[0],port:f[1]?f[1]:"",origin:d+"//"+e,pathname:j,search:h,hash:i,href:b,replaceResource:function(a){if(s.test(this.pathname)){var b=s.exec(this.pathname)[0];this.pathname=this.pathname.replace(b,"/"+a)}return this.href=F(this),this},secure:function(){var a=/http:/i,b="https:";return this.origin=this.origin.replace(a,b),this.protocol=this.protocol.replace(a,b),this.href=this.href.replace(a,b),this},appendToHash:function(a,b,c){return this.hash=n(this.hash,"#",a,b,c),this.href=F(this),this},appendToSearch:function(a,b,c){return this.search=n(this.search,"?",a,b,c),this.href=F(this),this}}},H=function(b,c,d,e){a.notEmpty(b,"url"),a.isObject(c,"params"),a.assert(void 0===d||"?"===d||"#"===d,"invalid separator value"),a.assert(void 0===e||"boolean"==typeof e,"invalid encodeParams value"),d=d||"?",void 0===e&&(e=!0);var f=b.split(d),g=[];if(f.length>1&&g.push(f[1]),"object"==typeof c){var h,i;for(h in c)i=c[h],g.push(h+"="+(e?encodeURIComponent(i):i))}var j=f[0];return g.length&&(j+=d+g.join("&")),j},I=function(b,c){a.notEmpty(b,"url"),a.assert(void 0===c||"?"===c||"#"===c,"invalid separator value"),c=c||"?";var d={},e=b.split(c);e.length>2&&(e[1]=e.splice(1,e.length-1).join(c));var f,g,h,i,j;if(e.length>1)for(f=e[1].split("&"),h=0;h<f.length;h++)g=f[h].split("="),i=g[0],g.splice(0,1),j=g.join("")||null,d[i]=decodeURIComponent(j);return d},J=function(b,c,d,e,f){a.isObject(b,"storage"),a.isFunction(c,"handler"),"object"!=typeof f&&(f=window),f.addEventListener("storage",c)},K=function(b,c,d){a.isObject(b,"storage"),a.notEmpty(c,"key"),a.isScalar(d,"value"),b.setItem(c,d)},L=function(b,c){a.isObject(b,"storage"),a.notEmpty(c,"key"),b.removeItem(c)},M=function(b,c){return a.isObject(b,"storage"),a.notEmpty(c,"key"),b.getItem(c)},N=function(b,c){a.isObject(b,"storage"),a.notEmpty(c,"key");var d=b.getItem(c);return null!==d&&b.removeItem(c),d},O=function(b,c,d){a.isObject(b,"storage"),a.notEmpty(c,"prefix"),a.isNumber(d,"index");for(var e=[],f=d;--f>=0;){var g=c+"-"+f,h=N(b,g);if(null===h)break;e.unshift({key:g,newValue:h})}return e},P=function(b,c){a.isObject(b,"storage"),a.instanceOf(c,RegExp,"RegExp");for(var d,e="function"==typeof b.length?b.length():b.length;--e>=0;){var f=b.key(e),g=c.exec(f);if(null!==g){var h=parseInt(g[1],10);(void 0===d||h>d)&&(d=h)}}return d},Q="chat-style",R=document.createElement(Q),S=document.createElement(Q+2),T={},U="Webkit Moz O ms",V=U.split(" "),W=function(b){a.notEmpty(b,"prop");for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=(b+" "+V.join(c+" ")+c).split(" "),e=0;e<d.length;e++){var f=d[e];if(-1===f.indexOf("-")&&void 0!==R.style[f])return!0}return!1},X=function(b){a.isObject(b,"element"),b.style.cssText="",b.className=""},Y={"borderbox-minwh":function(){R.style.cssText="box-sizing: border-box; -moz-box-sizing: border-box; min-width: 40px; padding: 0 10px; position: absolute; z-index: -1;",document.body.appendChild(R);var a=R.offsetWidth;return document.body.removeChild(R),X(R),40===a},"css3-pseudo-selectors":function(){R.style.cssText="visibility: hidden; position: absolute; z-index: -1;";var a=Z(Q+":empty { width: 10px; }");document.body.appendChild(R);var b=R.offsetWidth;return document.body.removeChild(R),X(R),$(a),10===b},"border-radius":function(){return W("borderRadius")},placeholder:function(){return"placeholder"in document.createElement("input")},"input-event":function(){return"oninput"in document.createElement("input")},"css-repaint":function(){var a=Z(".c1,.c2 { position: absolute; visibility: hidden; z-index: -1; } .c1 { display: block; } .c2 { display: none; width: 10px; } .c1.c3 ~ .c2 { display: block; }");R.style.cssText="",R.className="c1 c3",S.style.cssText="",S.className="c2",document.body.appendChild(R),document.body.appendChild(S);var b=S.offsetWidth;R.className="c1";var c=S.offsetWidth;return document.body.removeChild(R),document.body.removeChild(S),X(R),X(S),$(a),10===b&&0===c},"textarea-maxlength":function(){var a=document.createElement("textarea");return a.setAttribute("maxlength",1),"number"==typeof a.maxLength},"css3-animation":function(){var a=!1,b=document.createElement("div"),c="";if(void 0!==b.style.animationName&&(a=!0),!1===a)for(var d=0;d<V.length;d++)if(void 0!==b.style[V[d]+"AnimationName"]){c=V[d],c+"Animation","-"+c.toLowerCase()+"-",a=!0;break}return a},audio:function(){return!!document.createElement("audio").canPlayType},formData:function(){return!!window.FormData},xhr:function(){var a=new XMLHttpRequest;return!!(a&&"upload"in a&&"onprogress"in a.upload)}},Z=function(b,c){a.notEmpty(b,"css");var d=c||document.head,e=document.createElement("style");e.type="text/css";try{e.innerHTML=b}catch(f){e.styleSheet.cssText=b}return d.appendChild(e),e},$=function(b,c){a.isObject(b,"style"),(c||document.head).removeChild(b)},_=function(a){return a.replace(/^\s+|\s+$/g,"")},aa=function(a,b){b=_(b),a.classList?a.classList.add(b):a.className+=" "+b},ba=function(a,b){b=_(b),a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp("(^|\\b)(\\s*)"+b.split(" ").join("(\\s*)|(\\s*)")+"(\\s*)(\\b|$)","g")," ")},ca=function(a,b){a.classList?a.classList.contains(b):new RegExp("(^| )"+b+"( |$)","gi").test(a.className)},da=function(a){a.style.display="none"},ea=function(a){a.style.display="block"},fa=function(){return document.hasFocus?document.hasFocus():document.hidden?!document.hidden:document.visibilityState?"visible"===document.visibilityState:document.mozVisibilityState?"visible"===document.mozVisibilityState:document.msVisibilityState?"visible"===document.msVisibilityState:document.webkitVisibilityState?"visible"===document.webkitVisibilityState:void 0},ga=function(b){a.notEmpty(b),a.isFunction(Y[b],"featureTests["+b+"]");var c=T[b];return void 0!==c?c:(c=Y[b].call(),T[b]=c,c)},ha=function(a){var b,c,d=new Date;return d=new Date(d.getFullYear(),d.getMonth(),d.getDate()+a,d.getHours(),d.getMinutes(),d.getSeconds()),b=d.getDate().toString(),b=b[1]?b:"0"+b,c=(d.getMonth()+1).toString(),c=c[1]?c:"0"+c,d.getFullYear()+"-"+c+"-"+b},ia={uuid:d,lpad:u,random:e,getCallbackName:f,extend:c,atob:w,btoa:x,isUndefOrNull:v,isIFrame:y,isPopup:z,isInPage:A,getWindowParams:B,generateSecureWindowName:C,noop:n,normalizeUrl:D,getOriginFromUrl:E,parseUrl:G,formatUrl:F,appendUrlParams:H,parseUrlParams:I,addStorageEventListener:J,setStorageItem:K,getStorageItem:M,removeStorageItem:L,takeStorageItem:N,takeStorageItemsWithPrefixBeforeIndex:O,findMaxStorageItemIndexWithPrefix:P,injectScript:t,injectStyleSheet:Z,removeStyleSheet:$,trim:_,addClass:aa,removeClass:ba,hasClass:ca,hide:da,show:ea,documentHasFocus:fa,testStyleBorderBoxMinWidthHeight:function(){return ga("borderbox-minwh")},testCss3PseudoSelectors:function(){return ga("css3-pseudo-selectors")},testCss3Animations:function(){return ga("css3-animation")},testBorderRadius:function(){return ga("border-radius")},testPlaceholder:function(){return ga("placeholder")},testInputEvent:function(){return ga("input-event")},testCssRepaint:function(){return ga("css-repaint")},testTextareaMaxLength:function(){return ga("textarea-maxlength")},testLocalStorage:function(){var a=!1,b="testLS",c="works";try{localStorage.setItem(b,c);var d=localStorage.getItem(b);localStorage.removeItem(b),a=d===c}catch(e){}return a},getObjectWithoutProperties:function(a,b){var c={};for(var d in a)b.indexOf(d)>=0||Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);return c},testIFrameLocalStorage:function(){if(!this.testLocalStorage())return!1;if(void 0!==b.safariVersion)return!1;b.ieVersion;return!0},testAudio:function(){return ga("audio")},testFormData:function(){return ga("formData")},testXhr:function(){return ga("xhr")},getInputEvent:function(){return ia.testInputEvent()&&!b.ieVersion?"input":"keyup"},getDateValue:ha,getTimezoneInMin:g,getFunctionReference:k,addSpaceListener:l,stopEvent:i,removeSpaceListener:m};return ia}),c("config-custom",[],function(){return{}}),c("cookie",["assert","utils"],function(a,b,c){var d=500,e=new Date(0),f=/[\-\.\+\*]/g,g=/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,h=/\s*(?:\=[^;]*)?;\s*/,i=/;\s+/,j=function(){this.initialize.apply(this,arguments)};b.extend(j.prototype,{initialize:function(b,c){a.isObject(b,"manager"),a.isFunction(c,"fnSnapshot"),this._manager=b,this.takeSnapshot=c,this._listeners=[],this._snapshot=void 0,this._timeout=void 0},addListener:function(a){this._listeners.push(a),this._timeout||this.start()},removeListener:function(a){if(this._listeners.length){if(void 0===a)return void(this._listeners.length=0);for(var b=this._listeners.length,c=0;c<b;c++)if(this._listeners[c]===a){this._listeners.splice(c,1);break}}},notifyListeners:function(a){for(var b=this._listeners.length,c=0;c<b;c++)try{this._listeners[c](a)}catch(d){}},_poll:function(){a.assert(!this._timeout,"already polling");var b=this,c=this._manager;this._snapshot=this.takeSnapshot(),this._timeout=setTimeout(function(){b._timeout=void 0;var a=b._snapshot;if(b._snapshot=void 0,b._listeners.length){for(var d=[],e=c.keys(),f=e.length,g=0;g<f;g++){var h=e[g],i=c.getItem(h),j=k(h,a);i!==j&&d.push({key:h,oldValue:j,newValue:i})}for(var l=d.length,m=0;m<l;m++)b.notifyListeners(d[m]);b._listeners.length&&b._poll()}},d)},start:function(){this._poll()}});var k=function(a,b){return decodeURIComponent(b.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(f,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},l=function(b,c,d){var e=[encodeURIComponent(b)+"="+encodeURIComponent(c)];return void 0!==d.expires&&(a.instanceOf(d.expires,Date,"Date"),e.push("expires="+d.expires.toUTCString())),void 0!==d.domain&&(a.notEmpty(d.domain,"options.domain"),e.push("domain="+d.domain)),void 0!==d.path&&(a.notEmpty(d.path,"options.path"),e.push("path="+d.path)),d.secure&&(a.assert(!0===d.secure,"expected options.secure to be true when specified"),e.push("secure")),e.join(";")};return{setItem:function(b,c,d){return a.notEmpty(b,"key"),a.isScalar(c,"value"),void 0===d&&(d={}),document.cookie=l(b,c,d),this},getItem:function(b){return a.notEmpty(b,"key"),k(b,document.cookie)},exists:function(b){return a.notEmpty(b,"key"),new RegExp("(?:^|;\\s*)"+encodeURIComponent(b).replace(f,"\\$&")+"\\s*\\=").test(document.cookie)},removeItem:function(c,d){return a.notEmpty(c,"key"),d=b.extend({},d,{expires:e}),document.cookie=l(c,"",d),this},addEventListener:function(b){return a.isFunction(b,"listener"),this._poller||(this._poller=new j(this,function(){return document.cookie})),this._poller.addListener(b),this},removeEventListener:function(a){if(this._poller)return this._poller.removeListener(a),this},key:function(b){if(a.isNumber(b,"index"),b<0)return null;var c=this.keys(),d=c[b];return void 0!==d?d:null},keys:function(){var a=document.cookie;if(0===a.length)return[];for(var b=a.replace(g,"").split(h),c=b.length,d=0;d<c;d++)b[d]=decodeURIComponent(b[d]);return b},length:function(){var a=document.cookie;return 0===a.length?0:a.split(i).length},clear:function(b,c){b&&a.isFunction(b.test,"rxFilter.test");for(var d=0,e=this.keys(),f=e.length,g=0;g<f;g++){var h=e[g];b&&!b.test(h)||(this.removeItem(h,c),++d)}return d},noop:function(){}}}),c("chat-context-constants",{WINDOW_NAME:{PARENT:"parent",CHAT:"chat"},CHAT_STATUS:{OFFERED:"offered",ACCEPTED:"accepted",DECLINED:"declined",IGNORED:"ignored",ON_CHAT:"onChat",INTERACTIVE:"interactive",ENDED:"ended",WINDOW_OPENED:"windowOpened",WINDOW_LOADED:"windowLoaded",WINDOW_CLOSED:"windowClosed"},CHAT_COMMAND:{READY:"ready",SHOW_PCONTENT:"show-pcontent",HIDE_PCONTENT:"hide-pcontent",CLOSE:"close",MINIMIZE:"minimize",MAXIMIZE:"maximize",NEW_UNREAD_MESSAGE:"new-unread-message",UPDATE_SESSION:"update-session",FINALIZE_CHAT:"finalize-chat",TRACK_EVENT:"track",SYSTEM_MESSAGE:"system",UPDATE_CHAT_STATUS:"update-chat-status",USER_ENDED_CHAT:"user-ended-chat",AUTO_CLOSE:"auto-close"},SESSION:{STATES:{INVITE_ACCEPTED:"invite_accepted",IDLE:"idle",RECONCILING:"reconciling",CHAT_REQUESTED:"chat_requested",CHATTING:"chatting",POSTCHAT:"postchat",FINAL:"final"},MINIMIZED:"minimized",WORKFLOW:"workflow",RECONCILE_METHOD:{WINDOW_NAME:"window.name",PXOE:"pxoe"},JOURNEY:"urls"},SOCKET:{CONNECT:"connect",INIT:"init",READY:"ready",CHATREADY:"chatReady",PARENTREADY:"parentReady",CONTEXT:"context",DISCONNECT:"disconnect"}}),c("context-channel",["assert","assert-weak","utils","config-custom","cookie","module","chat-context-constants","browser"],function(a,b,c,d,e,f,g,h){var i=c.extend({},f.config(),d[f.id]),j=function(){},k=function(){throw"instance not allowed"};c.extend(k.prototype,{initialize:function(a){this._channelConfig=a,this._name=a.name,this._ready=!1,this._sourceKey=a.sourceKey,this._destKey=a.destKey,this._sourceKeyRx=new RegExp("^"+this._sourceKey+"-(\\d+)"),this._destKeyRx=new RegExp("^"+this._destKey+"-(\\d+)"),this._sourceOrigin=a.sourceOrigin,this._destOrigin=a.destOrigin,this._storage=a.storage||window.localStorage,this._contextQueue=[],this._onContextUpdate=j,this._commandListeners=[],this._iePoller=void 0,this._iePollerInterval=500,"function"!=typeof a.onContextUpdate&&(a.onContextUpdate=j),"function"!=typeof a.onStateChange&&(a.onStateChange=c.noop),this.setContextListener(function(b){a.onContextUpdate(b),b.track||a.onStateChange(b)}),"function"==typeof a.onCommand&&this.addCommandListener(a.onCommand);this._clearSourceContextStorage();this._flush()},setContextListener:function(b){return a.isFunction(b,"listener"),this._onContextUpdate=b,this},addCommandListener:function(b,c){return a.isFunction(b,"listener"),this._commandListeners.push({listener:b,context:c}),this},removeCommandListener:function(b){a.isFunction(b,"listener");for(var c=0;c<this._commandListeners.length;c++)if(b===this._commandListeners[c].listener)return this._commandListeners.splice(c,1),this;return this},sendCommand:function(b,c){a.notEmpty(b,"command"),b===g.CHAT_COMMAND.SYSTEM_MESSAGE&&a.assert(c.text&&c.text.length<1e3,"text is more than 1000 chars");var d={_chatCommand:b};return void 0!==c&&(d.data=c),this.sendContext(d),this},sendCommandToSelf:function(b,c){a.notEmpty(b,"command"),b===g.CHAT_COMMAND.SYSTEM_MESSAGE&&a.assert(c.text&&c.text.length<1e3,"text is more than 1000 chars");var d={_chatCommand:b};return void 0!==c&&(d.data=c),this._handleInboundContext(JSON.stringify(d)),this},deactivate:function(){},usesWebsocket:function(){return!1},_activate:function(){for(this._ready=!0;this._contextQueue.length;){var a=this._contextQueue.shift();this.sendContext(a)}},_flush:function(){var a=c.findMaxStorageItemIndexWithPrefix(this._storage,this._destKeyRx);isNaN(a)||this._flushInboundContexts(a+1)},_queueContext:function(a){var b=!1;return this._ready||(this._contextQueue.push(a),b=!0),b},_handleInboundContext:function(a){var b,c=this;try{b=JSON.parse(a)}catch(d){}void 0!==b&&setTimeout(function(){if(b._chatCommand){for(var a=0;a<c._commandListeners.length;a++)c._commandListeners[a].listener(b._chatCommand,b.data,c._commandListeners[a].context);b._chatCommand==g.CHAT_COMMAND.UPDATE_CHAT_STATUS&&c._onContextUpdate({chatStatus:b.data})}else c._onContextUpdate(b)},0)},_flushInboundContexts:function(a){var b=c.takeStorageItemsWithPrefixBeforeIndex(this._storage,this._destKey,a),d=b.length;if(d)for(var e=0;e<d;e++){var f=b[e];this._handleInboundContext(f.newValue)}},_clearSourceContextStorage:function(){var a=0;for(var b in this._storage)this._sourceKeyRx.test(b)&&(this._storage.removeItem(b),++a);return a}});var l=function(){this.initialize.apply(this,arguments)};c.extend(l.prototype,k.prototype,{initialize:function(a){c.extend(a,{storage:e}),k.prototype.initialize.call(this,a),this._contextIndex=0,this._cookieOptions={path:"/"},e.setItem("by247-chat","1",this._cookieOptions);var b=this,d=function(a){var c;a.newValue&&(c=a.key.match(b._destKeyRx))&&(b._flushInboundContexts(parseInt(c[1],10)),b._handleInboundContext(a.newValue),e.removeItem(a.key,b._cookieOptions))};e.addEventListener(d),this._activate()},sendContext:function(b){a.isObject(b,"context"),this._queueContext(b)||e.setItem(this._sourceKey+"-"+this._contextIndex++,JSON.stringify(b),this._cookieOptions)},_clearSourceContextStorage:function(){var a=0,b=c.findMaxStorageItemIndexWithPrefix(e,this._sourceKeyRx);if(isNaN(b))a=e.clear(this._sourceKeyRx,this._cookieOptions);else{a=c.takeStorageItemsWithPrefixBeforeIndex(e,this._sourceKey,b+1).length}return a}});var m=function(){this.initialize.apply(this,arguments)};c.extend(m.prototype,k.prototype,{initialize:function(a){k.prototype.initialize.apply(this,arguments),this._contextIndex=0;var b=this;h.ieVersion&&9!==h.ieVersion?this._iePoller=window.setInterval(function(){localStorage.setItem("by247-chat","1"),localStorage.removeItem("by247-chat");for(var a=[],d=0;d<localStorage.length;d++){var e=localStorage.key(d);null!==e&&e.match(b._destKeyRx)&&(b._handleInboundContext(c.getStorageItem(localStorage,e)),a.push(e))}for(d=0;d<a.length;d++)c.removeStorageItem(localStorage,a[d])},this._iePollerInterval):c.addStorageEventListener(this._storage,function(a){var d;a.newValue&&(d=a.key.match(b._destKeyRx))&&(b._flushInboundContexts(parseInt(d[1],10)),b._handleInboundContext(a.newValue),c.removeStorageItem(b._storage,a.key))},b._destKey,b._sourceKey,window);var d=c.findMaxStorageItemIndexWithPrefix(this._storage,this._destKeyRx);void 0!==d&&this._flushInboundContexts(d+1),this._activate()},sendContext:function(b){a.isObject(b,"context"),this._queueContext(b)||c.setStorageItem(this._storage,this._sourceKey+"-"+this._contextIndex++,JSON.stringify(b))}});var n=function(){throw"instance not allowed"};c.extend(n.prototype,k.prototype,{initialize:function(a){k.prototype.initialize.apply(this,arguments),this._destWindow=null,this._destOrigin=location.origin},sendContext:function(b){a.isObject(b,"context"),this._queueContext(b)||this._destWindow.postMessage(JSON.stringify(b),this._destOrigin)},_clearSourceContextStorage:function(){return 0}});var o=function(){this.initialize.apply(this,arguments)};c.extend(o.prototype,n.prototype,{initialize:function(a){n.prototype.initialize.apply(this,arguments);var b=this;this._contextListener=function(a){a.origin===b._destOrigin&&b._handleInboundContext(a.data)},this._waitForPeer()},_activate:function(){n.prototype._activate.apply(this),window.addEventListener("message",this._contextListener)},_waitForPeer:function(){var a=this,b=function(c){c.origin===a._destOrigin&&"peerReady"===c.data&&(window.parent.removeEventListener("message",b),a._destWindow=c.source,a._activate())};window.addEventListener("message",b)},deactivate:function(){this._ready&&(this._ready=!1,this._destWindow=null,window.parent.removeEventListener("message",this._contextListener),this._waitForPeer())}});var p=function(){this.initialize.apply(this,arguments)};c.extend(p.prototype,n.prototype,{initialize:function(a){n.prototype.initialize.apply(this,arguments);try{var b=window.parent.document.getElementById(a.pxoeFrameId);this._destWindow=b?b.contentWindow:window.parent}catch(d){this._destWindow=window.parent}var c=this;window.addEventListener("message",function(a){a.origin===c._destOrigin&&c._ready&&c._handleInboundContext(a.data)}),this._activate(),this._destWindow.postMessage("peerReady",this._destOrigin)}});var q=function(){this.initialize.apply(this,arguments)};c.extend(q.prototype,k.prototype,{initialize:function(b){k.prototype.initialize.apply(this,arguments),a.notEmpty(b.socketioPath,"channelConfig.socketioPath"),a.notEmpty(b.contextServer,"channelConfig.contextServer"),this._socket=null,b.waitForPeer||this.load()},load:function(){var a=this;this.contextSessionId=this._channelConfig.contextSessionId||c.uuid(),c.injectScript(this._channelConfig.socketioPath,function(){a._socket?a._socket.socket.reconnect():(a._socket=io.connect(a._channelConfig.contextServer,{reconnect:!0,query:"contextSessionId="+a.contextSessionId}),a._socket.on(g.SOCKET.CONNECT,function(){a._channelConfig.name===g.WINDOW_NAME.PARENT?(a._socket.emit(g.SOCKET.PARENTREADY),a._activated||a._socket.on(g.SOCKET.CHATREADY,function(){a._activate()})):(a._socket.emit(g.SOCKET.CHATREADY),
a._socket.on(g.SOCKET.PARENTREADY,function(){a._activate()}))}))},window.document,{id:"chat-socket-io"}),this._contextListener=function(b){a._handleInboundContext(JSON.stringify(b))}},_activate:function(){k.prototype._activate.apply(this,arguments);var a=this;this._ready=!0,this._activated||(this._socket.on(g.SOCKET.CONTEXT,function(b){a._contextListener(b)}),this._activated=!0)},sendContext:function(b){a.isObject(b,"context"),this._queueContext(b)||this._socket.emit(g.SOCKET.CONTEXT,b)},_clearSourceContextStorage:function(){return 0},deactivate:function(){this._ready&&(this._ready=!1,this._socket.disconnect(),this._socket.on(g.SOCKET.DISCONNECT,function(){}))},usesWebsocket:function(){return!0},getContextSessionId:function(){return this.contextSessionId}});var r=function(){this.initialize.apply(this,arguments)};c.extend(r.prototype,k.prototype,{initialize:function(b){a.notEmpty(b.proxyUrl,"channelConfig.proxyUrl"),k.prototype.initialize.apply(this,arguments);var d=this;if(this._proxyOrigin=c.getOriginFromUrl(b.proxyUrl),window.addEventListener("message",function(a){a.origin===d._proxyOrigin&&(d._ready?d._handleInboundContext(a.data):"proxyReady"===a.data&&d._activate())}),this._proxyFrame=document.getElementById(b.proxyFrameId),this._proxyFrame);else{this._proxyFrame=document.createElement("iframe");var e=c.parseUrl(b.proxyUrl);e.appendToHash({sourceOrigin:this._sourceOrigin,sourceKey:this._sourceKey,destKey:this._destKey});var f=c.formatUrl(e);c.extend(this._proxyFrame,{id:b.proxyFrameId,src:f,name:b.proxyFrameId,scrolling:"no",frameborder:"0",width:"0",height:"0"}),this._proxyFrame.style.display="none",document.body.appendChild(this._proxyFrame)}},sendContext:function(b){a.isObject(b,"context"),this._queueContext(b)||this._proxyFrame.contentWindow.postMessage(JSON.stringify(b),this._proxyOrigin)},_clearSourceContextStorage:function(){return 0}});var s=c.noop;return c.extend(s.prototype,{sendContext:c.noop,initialize:c.noop,setContextListener:c.noop,addCommandListener:c.noop,removeCommandListener:c.noop,sendCommand:c.noop,usesWebsocket:c.noop,deactivate:c.noop}),{make:function(d){a.isObject(d,"channelConfig");var e=c.extend({},i,d);if(a.notEmpty(e.sourceKey,"config.sourceKey"),a.notEmpty(e.destKey,"config.destKey"),a.assert(e.sourceKey!==e.destKey,"config.sourceKey must not equal config.destKey"),e.inPage)return e.waitForPeer?new o(e):new p(e);if(!e.sourceOrigin||!e.destOrigin)return new s;if(!c.testLocalStorage())return new s;if(e.forceCrossOrigin||e.sourceOrigin!==e.destOrigin)if(e.proxyUrl){a.notEmpty(e.proxyUrl,"channelConfig.proxyUrl");var f=c.getOriginFromUrl(e.proxyUrl);location.origin===f?c.testIFrameLocalStorage()?("storage-based chat",channel=new m(e)):("cookie-based chat",channel=new l(e)):("parent",channel=new r(e))}else b.notEmpty(!1,"channelConfig.proxyUrl"),channel=new s;else channel=new m(e);return channel}}}),c("common-constants",{INVITE:{SESSION_KEYS:{CREATED:"created",UPDATED:"updated",STATE:"state",INVITEID:"inviteId",RULEID:"ruleId",RC:"rc",CLID:"clid",APPID:"appId"}},COBROWSE:{STATES:{INVITED:"INVITED",INITIALIZED:"INITIALIZED",TIMEOUT:"TIMEOUT",STARTED:"STARTED",JOINED:"JOINED",ENDED:"ENDED"},TNC:{COBROWSE:"/f cobrowsetnc",COVIEW:"/f cobrowsetnc"},MODE:{COBROWSE:"cobrowse",COVIEW:"coview"}},LOGEVENTS:{VISITOR_BEFORE_CHAT_QUEUE:10002,VISITOR_ENTERED_CHAT_QUEUE:10003,VISITOR_ENTERED_CHAT:10004,CHAT_ENDED:10005,VISITOR_HAD_INTERACTIVE_CHAT:10006,CHAT_TRANSFERRED:10009,FORM_SHOWN:10010,FORM_SUBMITTED:10011,INVITE_OFFERED:11103,INVITE_ACCEPTED:11104,INVITE_DECLINED:11105,INVITE_IGNORED:11106,APP_ENDED:11107,AGENT_UNAVAILABLE:11108,AGENT_PANEL_CONTENT_SHOWN:10010,AGENT_PANEL_SHOWN:400101,AGENT_PANEL_HIDDEN:400102,AGENT_PANEL_BUTTON_CLICKED:400104,CHAT_MINIMIZED:111003,CHAT_ENDED_IN_PRECHAT:705001,CHAT_ENDED_IN_MINIMIZED:705002,CHAT_ENDED_IN_MAXIMIZED:705003,CHAT_FONT_INCREASED:705004,CHAT_FONT_DECREASED:705005,CHAT_MINIMIZED_BY_SWIPE:705006,CHAT_MAXIMIZED:111004,CHAT_ENDED_BEFORE_PRECHAT:705008,CHAT_ENDED_BEFORE_CHAT:705009,TECHNICAL_EXCEPTION:705010,COMET_RETRY_STARTED:705011,AGENT_METADATA_RECEIVED:705012,COMET_CONNECTION_BROKEN:705013,COMET_CONNECTION_RESTORED:705014,TRY_AGAIN:705015,THANKS_SHOWN:705016,RECONNECT:705017,FEEDBACK_SKIPPED:705018,AGENT_UNAVAILABLE_SKIPPED:705019,COBROWSE_INITIATED:10013,COBROWSE_STARTED:10014,COBROWSE_ENDED:10015,FILE_TRANSFER_START:100111,FILE_TRANSFER_RETRY:100113,FILE_TRANSFER_END:100112}}),c("chat-util-constants",["utils","common-constants"],function(a,b){var c={CHAT_UTIL_ELEMENT_ID:"chat-util",SESSION_KEY:"by247-chat-session",CONTENT_PATH:"content",INIT_CONFIG:"initconfig.js",DATA_ATTRIBUTES:{AUTO:"auto",CONFIGROOT:"configroot",CLIENTKEY:"key",APPID:"appId",CALLBACK:"callback"},XD_COMMANDS:{INITIALIZE:"init",SET:"set",GET:"get",REMOVE:"remove"},VIEWS:{INVITE:"invite"},CHANNEL:{INVITE:"invite",CHAT:"chat",SELFSERVE:"selfserve",CALL:"call"},FETCH_REASON:{RECONCILE:"reconcile",INVITE:"invite"},INVITE:{PREFIX:"by247-invite-",STATES:{AVAILABLE:"available",BUSY:"busy",CHATTING:"chatting",OFFLINE:"offline"},OUTCOMES:{ACCEPT:"accept",DECLINE:"decline",IGNORE:"ignore"},AVAILABILITY:{TRUE:"true",FALSE:"false",CHAT:"chat"},AVAILABILITY_CHECK:{REQUEST:"request",RESPONSE:"response"}},USER_ENDED_CHAT:"userendedchat"};return a.extend(c,b)});/*

Copyright (C) 2011 by Yehuda Katz

@license
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
var d={};!function(a,b){a.VERSION="1.0.0",a.COMPILER_REVISION=4,a.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},a.helpers={},a.partials={};var c=Object.prototype.toString,d="[object Function]",e="[object Object]";a.registerHelper=function(b,d,f){if(c.call(b)===e){if(f||d)throw new a.Exception("Arg not supported with multiple helpers");a.Utils.extend(this.helpers,b)}else f&&(d.not=f),this.helpers[b]=d},a.registerPartial=function(b,d){c.call(b)===e?a.Utils.extend(this.partials,b):this.partials[b]=d},a.registerHelper("helperMissing",function(a){if(2===arguments.length)return b;throw new Error("Missing helper: '"+a+"'")}),a.registerHelper("blockHelperMissing",function(b,e){var f=e.inverse||function(){},g=e.fn,h=c.call(b);return h===d&&(b=b.call(this)),!0===b?g(this):!1===b||null==b?f(this):"[object Array]"===h?b.length>0?a.helpers.each(b,e):f(this):g(b)}),a.K=function(){},a.createFrame=Object.create||function(b){a.K.prototype=b;var c=new a.K;return a.K.prototype=null,c},a.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(b,c){if(a.logger.level<=b){var d=a.logger.methodMap[b];"undefined"!=typeof console&&console[d]}}},a.log=function(b,c){a.logger.log(b,c)},a.registerHelper("each",function(b,e){var f,g=e.fn,h=e.inverse,i=0,j="";if(c.call(b)===d&&(b=b.call(this)),e.data&&(f=a.createFrame(e.data)),b&&"object"==typeof b)if(b instanceof Array)for(var k=b.length;i<k;i++)f&&(f.index=i),j+=g(b[i],{data:f});else for(var l in b)b.hasOwnProperty(l)&&(f&&(f.key=l),j+=g(b[l],{data:f}),i++);return 0===i&&(j=h(this)),j}),a.registerHelper("if",function(b,e){return c.call(b)===d&&(b=b.call(this)),!b||a.Utils.isEmpty(b)?e.inverse(this):e.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers.if.call(this,b,{fn:c.inverse,inverse:c.fn})}),a.registerHelper("with",function(b,e){if(c.call(b)===d&&(b=b.call(this)),!a.Utils.isEmpty(b))return e.fn(b)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)});var f=["description","fileName","lineNumber","message","name","number","stack"];a.Exception=function(a){for(var b=Error.prototype.constructor.apply(this,arguments),c=0;c<f.length;c++)this[f[c]]=b[f[c]]},a.Exception.prototype=new Error,a.SafeString=function(a){this.string=a},a.SafeString.prototype.toString=function(){return this.string.toString()};var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},h=/[&<>"'`]/g,i=/[&<>"'`]/,j=function(a){return g[a]||"&amp;"};a.Utils={extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},escapeExpression:function(b){return b instanceof a.SafeString?b.toString():null==b||!1===b?"":(b=b.toString(),i.test(b)?b.replace(h,j):b)},isEmpty:function(a){return!a&&0!==a||"[object Array]"===c.call(a)&&0===a.length}},a.VM={template:function(b){var c={escapeExpression:a.Utils.escapeExpression,invokePartial:a.VM.invokePartial,programs:[],program:function(b,c,d){var e=this.programs[b];return d?e=a.VM.program(b,c,d):e||(e=this.programs[b]=a.VM.program(b,c)),e},merge:function(b,c){var d=b||c;return b&&c&&(d={},a.Utils.extend(d,c),a.Utils.extend(d,b)),d},programWithDepth:a.VM.programWithDepth,noop:a.VM.noop,compilerInfo:null};return function(d,e){e=e||{};var f=b.call(c,a,d,e.helpers,e.partials,e.data),g=c.compilerInfo||[],h=g[0]||1,i=a.COMPILER_REVISION;if(h!==i){if(h<i){throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+a.REVISION_CHANGES[i]+") or downgrade your runtime to an older version ("+a.REVISION_CHANGES[h]+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+g[1]+")."}return f}},programWithDepth:function(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=function(a,e){return e=e||{},b.apply(this,[a,e.data||c].concat(d))};return e.program=a,e.depth=d.length,e},program:function(a,b,c){var d=function(a,d){return d=d||{},b(a,d.data||c)};return d.program=a,d.depth=0,d},noop:function(){return""},invokePartial:function(c,d,e,f,g,h){var i={helpers:f,partials:g,data:h};if(c===b)throw new a.Exception("The partial "+d+" could not be found");if(c instanceof Function)return c(e,i);if(a.compile)return g[d]=a.compile(c,{data:h!==b}),g[d](e,i);throw new a.Exception("The partial "+d+" could not be compiled when running in runtime-only mode")}},a.template=a.VM.template}(d),c("handlebars",[],function(){return d}),c("chatutiltemplate",["handlebars"],function(a){return this.JST=this.JST||{},this.JST.chatinpage=a.template(function(a,b,c,d,e){function f(a,b){var c;return k((c=a.animateEntry,typeof c===j?c.apply(a):c))}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this.escapeExpression,l=this;return i+='<div id="'+k((g=b.containerId,typeof g===j?g.apply(b):g))+'" class="'+k((g=b.containerId,typeof g===j?g.apply(b):g))+" "+k((g=b.state,typeof g===j?g.apply(b):g))+" by247-box-shadow animated ",h=c.if.call(b,b.animate,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+=' by247-chat-position"><div id="by247-chat-menu-bar" class="by247-chat-menu-bar"><div id="by247-chat-menu-label" class="by247-chat-menu-label">'+k((g=b.menubarLabel,typeof g===j?g.apply(b):g))+"</div><label class='chat-hidden' id=\"by247-chat-menu-show-hide-label\">"+k((g=b.showHideTitle,typeof g===j?g.apply(b):g))+'</label><div id="by247-chat-menu-show-hide" title="'+k((g=b.showHideTitle,typeof g===j?g.apply(b):g))+'" class="by247-chat-menu-show-hide" aria-labelledby="by247-chat-menu-show-hide-label" role="button" tabindex="0">&#x2198;</div><label class=\'chat-hidden\' id="by247-chat-menu-close-label">'+k((g=b.closeChatTitle,typeof g===j?g.apply(b):g))+'</label><div id="by247-chat-menu-close" title="'+k((g=b.closeChatTitle,typeof g===j?g.apply(b):g))+'" class="by247-chat-menu-close" aria-labelledby="by247-chat-menu-close-label" role="button" aria-hidden="true" tabindex="0">&times;</div><div id="by247-chat-message-badge" class="by247-chat-message-badge"></div></div><div id="by247-chat-drag-overlay" class="by247-chat-drag-overlay" style="height:'+k((g=b.chatIframeHeight,typeof g===j?g.apply(b):g))+'; display: none;"></div><iframe id="'+k((g=b.chatIframeId,typeof g===j?g.apply(b):g))+'" src="'+k((g=b.chatIframeSource,typeof g===j?g.apply(b):g))+'" title="'+k((g=b.windowTitle,typeof g===j?g.apply(b):g))+'" name="'+k((g=b.chatIframeName,typeof g===j?g.apply(b):g))+'" width="'+k((g=b.chatIframeWidth,typeof g===j?g.apply(b):g))+'" height="'+k((g=b.chatIframeHeight,typeof g===j?g.apply(b):g))+'" style="border: 0" frameborder="0"></iframe></div>'}),this.JST.chatnotify=a.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div id="'+i((f=b.containerId,typeof f===h?f.apply(b):f))+'" class="'+i((f=b.containerId,typeof f===h?f.apply(b):f))+" by247-chat-maximized by247-box-shadow by247-"+i((f=b.position,typeof f===h?f.apply(b):f))+'"><div id="by247-chat-menu-bar" class="by247-chat-menu-bar"><div id="by247-chat-menu-label" class="by247-chat-menu-label">'+i((f=b.menubarLabel,typeof f===h?f.apply(b):f))+"</div><label class='chat-hidden' id=\"by247-chat-menu-close-label\">"+i((f=b.closeChatTitle,typeof f===h?f.apply(b):f))+'</label><div id="by247-chat-menu-close" title="'+i((f=b.closeChatTitle,typeof f===h?f.apply(b):f))+'" class="by247-chat-menu-close" aria-labelledby="by247-chat-menu-close-label" role="button" tabindex="0">&times;</div><div id="by247-chat-message-badge" class="by247-chat-message-badge"></div></div><div id="by247-chat-quick-peek" class="by247-chat-quick-peek" style="width: '+i((f=b.width,typeof f===h?f.apply(b):f))+'px;"><div id="by247-chat-message-badge" class="by247-chat-message-badge"></div></div></div>'}),this.JST.chatnotifymessage=a.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div id="chat-message-'+j((f=b.id,typeof f===i?f.apply(b):f))+'" class="chat-message"><div class="name">'+j((f=b.fromName,typeof f===i?f.apply(b):f))+'</div><div class="content">',f=b.content,g=typeof f===i?f.apply(b):f,(g||0===g)&&(h+=g),h+="</div></div>"}),this.JST.clickables=a.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+='<input class="clickable'+k((c=b,c=null==c||!1===c?c:c.index,typeof c===j?c.apply(a):c))+'" id="clickable'+k((c=b,c=null==c||!1===c?c:c.index,typeof c===j?c.apply(a):c))+'" type="button" alt="'+k((c=a.title,typeof c===j?c.apply(a):c))+'" data-actions="'+k((c=a.name,typeof c===j?c.apply(a):c))+'"></input>'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this.escapeExpression,l=this;return i+='<div class="'+k((g=b.controlsContainerId,typeof g===j?g.apply(b):g))+'" id="'+k((g=b.controlsContainerId,typeof g===j?g.apply(b):g))+'">',h=c.each.call(b,b.clickables,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+="</div>"}),this.JST["invite-image"]=a.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+=l((c=a.animate,typeof c===k?c.apply(a):c))+" animated"}function g(a,b){var c,d;return c=a.controls,d=typeof c===k?c.apply(a):c,d||0===d?d:""}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i,j="",k="function",l=this.escapeExpression,m=this;return j+='<div id="'+l((h=b.containerId,typeof h===k?h.apply(b):h))+'" class="'+l((h=b.containerId,typeof h===k?h.apply(b):h))+" ",i=c.if.call(b,b.animate,{hash:{},inverse:m.noop,fn:m.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='">',i=c.if.call(b,b.controls,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+="</div>"}),this.JST["standard-button"]=a.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+=k((c=a.animate,typeof c===j?c.apply(a):c))+" animated"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this.escapeExpression,l=this;return i+='<div id="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-container" class="by247-standard-button ',h=c.if.call(b,b.animate,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+='" role="alertdialog"><label id="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-chat-button-label" class="chat-hidden">Please click on the button to chat with an expert</label><input id="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-chat-button" class="chat-button" aria-describedby="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-chat-button-label" role="button" type="button" alt="accept" title="accept" data-actions="accept" value="'+k((g=b.chatButtonText,typeof g===j?g.apply(b):g))+'" autofocus\\></div>'}),this.JST["standard-proactive"]=a.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+=k((c=a.animate,typeof c===j?c.apply(a):c))+" animated"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j="function",k=this.escapeExpression,l=this;return i+='<div id="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-container" class="by247-standard-proactive by247-standard-proactive-type'+k((g=b.type,typeof g===j?g.apply(b):g))+" ",h=c.if.call(b,b.animate,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+='" role="alertdialog"><div id="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-logo" class="logo"></div><label id="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-close-button-label" class="chat-hidden">close</label><a id="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-close-button" class="close-button" aria-describedby="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-close-button-label" type="button" alt="decline" role="button" tabindex="0" title="decline" data-actions="decline" value="&times;">&times;</a><div id="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-title" class="title">'+k((g=b.title,typeof g===j?g.apply(b):g))+'</div><div id="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-description" class="description">'+k((g=b.description,typeof g===j?g.apply(b):g))+'</div><label id="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-chat-button-label" class="chat-hidden">Please click on the chat button to start</label><input id="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-chat-button" class="chat-button" aria-describedby="'+k((g=b.inviteId,typeof g===j?g.apply(b):g))+'-chat-button-label" type="button" alt="accept" title="accept" data-actions="accept" value="'+k((g=b.chatButtonText,typeof g===j?g.apply(b):g))+'" autofocus\\></div>'}),this.JST}),c("draggable",["assert","utils","browser"],function(a,b,c){function d(b,c,d,e,g){a.isObject(b,"element"),p=c||b,q=d,o=b,i(),t=g,u=e,p.addEventListener("mousedown",f)}function e(){p&&p.removeEventListener("mousedown",f)}function f(a){b.stopEvent(a),i(),s=h(o),o.style.right=j(s.right),o.lastXPosition=k("x",a.clientX),u||(o.style.bottom=j(s.bottom),o.lastYPosition=k("y",a.clientY)),g()}function g(){q&&b.show(q),w.addEventListener("selectstart",l),w.addEventListener("dragstart",l),w.addEventListener("mousemove",m),w.addEventListener("mouseup",n)}function h(a){var b=a.getBoundingClientRect();return{bottom:r.y-b.bottom+v,right:r.x-b.right+v,x:b.right-b.left,y:b.bottom-b.top}}function i(){r={x:w.documentElement.clientWidth||w.body.clientWidth,y:w.documentElement.clientHeight||w.body.clientHeight}}function j(a){return a+"px"}function k(a,b){return r[a]-s[a]-b}function l(a){return b.stopEvent(a),!1}function m(a){b.addClass(o,"dragging"),b.stopEvent(a);var c=o.style,d=parseInt(c.right,10),e=parseInt(c.bottom,10),f=d+k("x",a.clientX+o.lastXPosition),g=e+k("y",a.clientY+o.lastYPosition);f>0&&f<k("x",0)&&(c.right=j(f),o.lastXPosition=k("x",a.clientX)),!u&&g>0&&g<k("y",0)&&(c.bottom=j(g),o.lastYPosition=k("y",a.clientY))}function n(a){w.removeEventListener("selectstart",l),w.removeEventListener("dragstart",l),w.removeEventListener("mousemove",m),w.removeEventListener("mouseup",n),q&&b.hide(q),b.removeClass(o,"dragging")}var o,p,q,r,s,t,u,v=8===c.ieVersion?2:0,w=parent.document;parent.window;return{add:d,remove:e}}),c("xd-communication-utils",["assert","utils","chat-util-constants"],function(a,b,c){function d(a){try{return window.btoa(unescape(encodeURIComponent(a)))}catch(b){}}function e(a){try{return decodeURIComponent(escape(window.atob(a)))}catch(b){}}var f,g,h,i={},j=function(){this.initialize.apply(this,arguments)};b.extend(j.prototype,{initialize:function(b){a.isObject(b.xdUrlObject,"options.xdUrlObject"),this._xdUrlObject=b.xdUrlObject,this._callback=b.callback,this._chatInit=b.thisArg,h=this._xdOrigin=this._xdUrlObject.origin,a.notEmpty(this._xdOrigin,"xdOrigin"),window.addEventListener("message",this._getXdMessageHandler(),!1),this._xdUrl=this._xdUrlObject.href,a.notEmpty(this._xdUrl,"xdUrl"),this._loadXdHtml(this._xdUrl)},_loadXdHtml:function(a){var b=null;b=document.createElement("iframe"),b.id="chatxdframe",b.src=a,document.getElementsByTagName("head")[0].appendChild(b),g=this._destWindow=b.contentWindow},_getXdMessageHandler:function(){var a=this;return function(b){var d={};if(b.origin==a._xdOrigin){try{d=JSON.parse(b.data)}catch(g){return}if(d.queryCommand===c.XD_COMMANDS.INITIALIZE){for(var f in d.data)d.data.hasOwnProperty(f)&&(i[f]=e(d.data[f]));a._callback.call(a._chatInit,i)}}}}});var k=function(a,b,c){var d={command:a,key:b,value:c};if(g&&h)return g.postMessage(JSON.stringify(d),h)},l=function(a){return i[a]},m=function(a,b){var e=d(b);k(c.XD_COMMANDS.SET,a,e),i[a]=b},n=function(a){k(c.XD_COMMANDS.REMOVE,a),delete i[a]},o=function(){return!!f};return{init:function(b){return a.assert(!f," XdCommunicationUtils already initialized!"),f=new j(b)},setItem:m,getItem:l,removeItem:n,isXdCommunicationEnabled:o}}),c("journey-store",["utils","assert","xd-communication-utils","chat-context-constants"],function(a,b,c,d){var e,f=[],g=(new Date).getTime(),h=5,i=function(){this.initialize.apply(this,arguments)};a.extend(i.prototype,{initialize:function(a){try{a&&(f=JSON.parse(a[d.SESSION.JOURNEY]),this._updateJourneyOrder(f))}catch(b){}this._updateJourney(),setInterval(this._updateJourney,1e4)},_updateJourneyOrder:function(a){for(a.unshift({});a.length>h;)a.pop()},_updateJourney:function(){var a={title:encodeURIComponent(parent.document.title),url:encodeURIComponent(parent.location.href),loadts:g,time:Math.round(((new Date).getTime()-g)/1e3)};f[0]=a,c.setItem(d.SESSION.JOURNEY,JSON.stringify(f))}});var j=function(){var a=[];if(!(f.length<=0)){for(var b=0;b<f.length;b++)a.push({title:decodeURIComponent(f[b].title),url:decodeURIComponent(f[b].url),loadts:f[b].loadts,time:f[b].time});return a}},k=function(a){var b,c,d=a||j(),e=1500;if(d&&0!==d.length){try{b=encodeURIComponent(JSON.stringify(d)),c=encodeURI(b)}catch(f){return}return c.length<=e?b:(d.pop(),k(d))}};return{init:function(a){return b.assert(!e,"JourneyStoreInit already initialized!"),e=new i(a)},getJourney:j,getJourneyEncoded:k}}),c("normalize",[],function(){function a(a,d,h){if(a.match(g)||a.match(f))return a;a=e(a);var i=h.match(f),j=d.match(f);return!j||i&&i[1]==j[1]&&i[2]==j[2]?c(b(a,d),h):b(a,d)}function b(a,b){if("./"==a.substr(0,2)&&(a=a.substr(2)),a.match(g)||a.match(f))return a;var c=b.split("/"),d=a.split("/");for(c.pop();curPart=d.shift();)".."==curPart?c.pop():c.push(curPart);return c.join("/")}function c(a,b){var c=b.split("/");for(c.pop(),b=c.join("/")+"/",i=0;b.substr(i,1)==a.substr(i,1);)i++;for(;"/"!=b.substr(i,1);)i--;b=b.substr(i+1),a=a.substr(i+1),c=b.split("/");var d=a.split("/");for(out="";c.shift();)out+="../";for(;curPart=d.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var d=/([^:])\/+/g,e=function(a){return a.replace(d,"$1/")},f=/[^\:\/]*:\/\/([^\/])*/,g=/^(\/|data:)/,h=function(b,c,d){c=e(c),d=e(d);for(var f,g,b,h=/@import\s*("([^"]*)"|'([^']*)')|url\s*\(\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/gi;f=h.exec(b);){g=f[3]||f[2]||f[5]||f[6]||f[4];var i;i=a(g,c,d);var j=f[5]||f[6]?1:0;b=b.substr(0,h.lastIndex-g.length-j-1)+i+b.substr(h.lastIndex-j-1),h.lastIndex=h.lastIndex+(i.length-g.length)}return b};return h.convertURIBase=a,h.absoluteURI=b,h.relativeURI=c,h}),/*
 * Require-CSS RequireJS css! loader plugin
 * 0.1.2
 * Guy Bedford 2013
 * @license MIT
 */
c("require-css",[],function(){if("undefined"==typeof window)return{load:function(a,b,c){c()}};var a=document.getElementsByTagName("head")[0],b=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/)||0,c=!1,d=!0;b[1]||b[7]?c=parseInt(b[1])<6||parseInt(b[7])<=9:b[2]?d=!1:b[4]&&(c=parseInt(b[4])<18);var e={};e.pluginBuilder="./css-builder";var f,g=function(){f=document.createElement("style"),a.appendChild(f)},h=function(a,b){g();var c=f.styleSheet||f.sheet;if(c&&c.addImport)c.addImport(a),f.onload=b;else{f.textContent='@import "'+a+'";';var d=setInterval(function(){try{f.sheet.cssRules,clearInterval(d),b()}catch(a){}},10)}},i=function(b,c){var e=document.createElement("link");if(e.type="text/css",e.rel="stylesheet",d)e.onload=function(){e.onload=function(){},setTimeout(c,7)};else var f=setInterval(function(){for(var a=0;a<document.styleSheets.length;a++){if(document.styleSheets[a].href==e.href)return clearInterval(f),c()}},10);e.href=b,a.appendChild(e)};return e.normalize=function(a,b){return".css"==a.substr(a.length-4,4)&&(a=a.substr(0,a.length-4)),b(a)},e.load=function(a,b,d,e){(c?h:i)(b.toUrl(a+".css"),d)},e}),c("require-css!chat-util-css",[],function(){!function(a){var b=window.parent.document,c="appendChild",d="styleSheet",e=b.createElement("style");e.type="text/css",e.id="by247-chat-util-stylesheet",b.getElementsByTagName("head")[0][c](e),e[d]?e[d].cssText=a:e[c](b.createTextNode(a))}('.by247-chat-frame-container{box-shadow:1px 0px 4px 0px rgba(50,50,50,0.5);-moz-box-shadow:1px 0px 4px 0px rgba(50,50,50,0.5);-webkit-box-shadow:1px 0px 4px 0px rgba(50,50,50,0.5);font-family:HelveticaNeue,\'Helvetica Neue\',Helvetica,Arial,Sans-Serif;font-size:14px;position:fixed;bottom:-3px;z-index:9999;cursor:default;background-color:#ffffff;line-height:normal;}.by247-chat-frame-container *{outline:none;}.by247-chat-minimized{height:30px;}.by247-box-shadow{filter:progid:DXImageTransform.Microsoft.Glow(color=#bebebe,Strength=1);}body:last-child .by247-box-shadow{filter:none;}.by247-chat-menu-bar{background:#999999;color:#ffffff;height:30px;line-height:30px;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;}.by247-chat-menu-label{font-weight:700;position:absolute;text-align:center;height:100%;left:30px;right:30px;overflow:hidden;}.by247-chat-menu-show-hide{cursor:pointer;height:100%;font-family:Arial,sans-serif;font-size:18px;left:10px;position:absolute;text-align:center;}.by247-chat-menu-show-hide:hover{color:#dddddd;}.by247-chat-menu-show-hide:active{color:#ffffff;}.by247-chat-menu-close{cursor:pointer;height:100%;font-family:Arial,sans-serif;font-size:18px;position:absolute;right:10px;text-align:center;display:none;}.by247-chat-menu-close:hover{color:#ff0f3b;}.by247-chat-menu-close:active{color:#8d1836;}.by247-chat-drag-overlay{width:100%;height:0;position:absolute;top:30px;background-color:transparent;}.by247-chat-message-badge{background-color:#ff0f3b;color:#ffffff;display:none;font-weight:bold;height:24px;width:24px;line-height:24px;position:absolute;right:0;text-align:center;border:1px solid #ffffff;margin:2px;}.by247-chat-quick-peek{clear:both;padding:0 20px;color:#333333;max-height:150px;line-height:17px;min-height:71px;overflow-y:hidden;}.by247-standard-proactive{position:fixed;font-family:"HelveticaNeue","Helvetica Neue",Helvetica,Arial,sans-serif;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;z-index:99999999}.by247-standard-proactive .close-button{top:6px;right:12px;position:absolute;text-decoration:none;float:right;border:0px;background-color:transparent;font-size:22px;cursor:pointer}.by247-standard-proactive .close-button:hover,.by247-standard-proactive .close-button:active{outline:none;text-decoration:none}.by247-standard-proactive .logo{height:80px;width:80px;float:left;background-repeat:no-repeat;}.by247-standard-proactive .title{font-size:26px;position:relative;line-height:normal;}.by247-standard-proactive .description{font-size:18px;position:relative;}.by247-standard-proactive .chat-button{border:0px;height:60px;width:200px;position:absolute;cursor:pointer;text-align:center;font-size:30px;}.by247-standard-button{height:60px;width:200px;position:fixed;bottom:0px;right:0px;font-family:"HelveticaNeue","Helvetica Neue",Helvetica,Arial,sans-serif;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;z-index:999999}.by247-standard-button .chat-button{border:0px;height:60px;width:200px;cursor:pointer;text-align:center;font-size:30px;}.by247-standard-proactive-type1{height:230px;width:420px;}.by247-standard-proactive-type1 .logo{margin:30px;}.by247-standard-proactive-type1 .title{top:26px;}.by247-standard-proactive-type1 .description{top:35px;}.by247-standard-proactive-type1 .chat-button{left:140px;bottom:30px;}.by247-standard-proactive-type2{height:400px;width:300px;}.by247-standard-proactive-type2 .logo{margin:20px;}.by247-standard-proactive-type2 .title{top:25px;padding-left:20px;padding-right:20px;clear:both;float:left;}.by247-standard-proactive-type2 .description{top:40px;padding-left:20px;padding-right:20px;clear:both;float:left;}.by247-standard-proactive-type2 .chat-button{left:47px;bottom:40px;}.by247-standard-proactive-type3{height:300px;width:500px;}.by247-standard-proactive-type3 .logo{height:88px;width:500px;}.by247-standard-proactive-type3 .title{top:20px;padding-left:30px;padding-right:30px;}.by247-standard-proactive-type3 .description{top:30px;padding-left:30px;padding-right:30px;}.by247-standard-proactive-type3 .chat-button{right:20px;bottom:20px;}.chat-message{clear:both;padding-top:10px;word-wrap:break-word;font-size:12px;}.chat-message .time{color:#cccaca;float:right;font-size:11px;font-style:normal;margin-left:10px;}.chat-message .name{font-weight:bold;}.chat-message .content{}.chat-hidden{display:none;}.selfserve-hidden{visibility:hidden;}.draggable{cursor:move;}.dragging{opacity:0.8;-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=80)";}@charset "UTF-8";.animated{-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-fill-mode:both;animation-fill-mode:both;}.animated.hinge{-webkit-animation-duration:2s;animation-duration:2s;}.animated.bounceIn,.animated.bounceOut{-webkit-animation-duration:.75s;animation-duration:.75s;}.animated.flipOutX,.animated.flipOutY{-webkit-animation-duration:.75s;animation-duration:.75s;}.animated.slideInUp,.animated.slideOutDown{-webkit-animation-duration:.5s;animation-duration:.5s;}@-webkit-keyframes bounce{0%,20%,53%,80%,100%{-webkit-transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);}40%,43%{-webkit-transition-timing-function:cubic-bezier(0.755,0.050,0.855,0.060);transition-timing-function:cubic-bezier(0.755,0.050,0.855,0.060);-webkit-transform:translate3d(0,-30px,0);transform:translate3d(0,-30px,0);}70%{-webkit-transition-timing-function:cubic-bezier(0.755,0.050,0.855,0.060);transition-timing-function:cubic-bezier(0.755,0.050,0.855,0.060);-webkit-transform:translate3d(0,-15px,0);transform:translate3d(0,-15px,0);}90%{-webkit-transform:translate3d(0,-4px,0);transform:translate3d(0,-4px,0);}}@keyframes bounce{0%,20%,53%,80%,100%{-webkit-transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);}40%,43%{-webkit-transition-timing-function:cubic-bezier(0.755,0.050,0.855,0.060);transition-timing-function:cubic-bezier(0.755,0.050,0.855,0.060);-webkit-transform:translate3d(0,-30px,0);transform:translate3d(0,-30px,0);}70%{-webkit-transition-timing-function:cubic-bezier(0.755,0.050,0.855,0.060);transition-timing-function:cubic-bezier(0.755,0.050,0.855,0.060);-webkit-transform:translate3d(0,-15px,0);transform:translate3d(0,-15px,0);}90%{-webkit-transform:translate3d(0,-4px,0);transform:translate3d(0,-4px,0);}}.bounce{-webkit-animation-name:bounce;animation-name:bounce;-webkit-transform-origin:center bottom;transform-origin:center bottom;}@-webkit-keyframes pulse{0%{-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1);}50%{-webkit-transform:scale3d(1.05,1.05,1.05);transform:scale3d(1.05,1.05,1.05);}100%{-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1);}}@keyframes pulse{0%{-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1);}50%{-webkit-transform:scale3d(1.05,1.05,1.05);transform:scale3d(1.05,1.05,1.05);}100%{-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1);}}.pulse{-webkit-animation-name:pulse;animation-name:pulse;}@-webkit-keyframes shake{0%,100%{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);}10%,30%,50%,70%,90%{-webkit-transform:translate3d(-10px,0,0);transform:translate3d(-10px,0,0);}20%,40%,60%,80%{-webkit-transform:translate3d(10px,0,0);transform:translate3d(10px,0,0);}}@keyframes shake{0%,100%{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);}10%,30%,50%,70%,90%{-webkit-transform:translate3d(-10px,0,0);transform:translate3d(-10px,0,0);}20%,40%,60%,80%{-webkit-transform:translate3d(10px,0,0);transform:translate3d(10px,0,0);}}.shake{-webkit-animation-name:shake;animation-name:shake;}@-webkit-keyframes bounceIn{0%,20%,40%,60%,80%,100%{-webkit-transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);}0%{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3);}20%{-webkit-transform:scale3d(1.1,1.1,1.1);transform:scale3d(1.1,1.1,1.1);}40%{-webkit-transform:scale3d(.9,.9,.9);transform:scale3d(.9,.9,.9);}60%{opacity:1;-webkit-transform:scale3d(1.03,1.03,1.03);transform:scale3d(1.03,1.03,1.03);}80%{-webkit-transform:scale3d(.97,.97,.97);transform:scale3d(.97,.97,.97);}100%{opacity:1;-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1);}}@keyframes bounceIn{0%,20%,40%,60%,80%,100%{-webkit-transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);}0%{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3);}20%{-webkit-transform:scale3d(1.1,1.1,1.1);transform:scale3d(1.1,1.1,1.1);}40%{-webkit-transform:scale3d(.9,.9,.9);transform:scale3d(.9,.9,.9);}60%{opacity:1;-webkit-transform:scale3d(1.03,1.03,1.03);transform:scale3d(1.03,1.03,1.03);}80%{-webkit-transform:scale3d(.97,.97,.97);transform:scale3d(.97,.97,.97);}100%{opacity:1;-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1);}}.bounceIn{-webkit-animation-name:bounceIn;animation-name:bounceIn;}@-webkit-keyframes bounceInRight{0%,60%,75%,90%,100%{-webkit-transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);}0%{opacity:0;-webkit-transform:translate3d(3000px,0,0);transform:translate3d(3000px,0,0);}60%{opacity:1;-webkit-transform:translate3d(-25px,0,0);transform:translate3d(-25px,0,0);}75%{-webkit-transform:translate3d(10px,0,0);transform:translate3d(10px,0,0);}90%{-webkit-transform:translate3d(-5px,0,0);transform:translate3d(-5px,0,0);}100%{-webkit-transform:none;transform:none;}}@keyframes bounceInRight{0%,60%,75%,90%,100%{-webkit-transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);}0%{opacity:0;-webkit-transform:translate3d(3000px,0,0);transform:translate3d(3000px,0,0);}60%{opacity:1;-webkit-transform:translate3d(-25px,0,0);transform:translate3d(-25px,0,0);}75%{-webkit-transform:translate3d(10px,0,0);transform:translate3d(10px,0,0);}90%{-webkit-transform:translate3d(-5px,0,0);transform:translate3d(-5px,0,0);}100%{-webkit-transform:none;transform:none;}}.bounceInRight{-webkit-animation-name:bounceInRight;animation-name:bounceInRight;}@-webkit-keyframes bounceInUp{0%,60%,75%,90%,100%{-webkit-transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);}0%{opacity:0;-webkit-transform:translate3d(0,3000px,0);transform:translate3d(0,3000px,0);}60%{opacity:1;-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);}75%{-webkit-transform:translate3d(0,10px,0);transform:translate3d(0,10px,0);}90%{-webkit-transform:translate3d(0,-5px,0);transform:translate3d(0,-5px,0);}100%{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);}}@keyframes bounceInUp{0%,60%,75%,90%,100%{-webkit-transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);transition-timing-function:cubic-bezier(0.215,0.610,0.355,1.000);}0%{opacity:0;-webkit-transform:translate3d(0,3000px,0);transform:translate3d(0,3000px,0);}60%{opacity:1;-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);}75%{-webkit-transform:translate3d(0,10px,0);transform:translate3d(0,10px,0);}90%{-webkit-transform:translate3d(0,-5px,0);transform:translate3d(0,-5px,0);}100%{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);}}.bounceInUp{-webkit-animation-name:bounceInUp;animation-name:bounceInUp;}@keyframes fadeIn{0%{opacity:0;}100%{opacity:1;}}.fadeIn{-webkit-animation-name:fadeIn;animation-name:fadeIn;}@-webkit-keyframes fadeOut{0%{opacity:1;}100%{opacity:0;}}@keyframes fadeOut{0%{opacity:1;}100%{opacity:0;}}.fadeOut{-webkit-animation-name:fadeOut;animation-name:fadeOut;}@-webkit-keyframes slideInUp{0%{-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0);visibility:visible;}100%{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);}}@keyframes slideInUp{0%{-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0);visibility:visible;}100%{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);}}.slideInUp{-webkit-animation-name:slideInUp;animation-name:slideInUp;}@-webkit-keyframes slideOutDown{0%{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);}100%{visibility:hidden;-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0);}}@keyframes slideOutDown{0%{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);}100%{visibility:hidden;-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0);}}.slideOutDown{-webkit-animation-name:slideOutDown;animation-name:slideOutDown;}')}),c("chat-util-controller",["assert","handlebars","chatutiltemplate","utils","chat-context-constants","chat-util-constants","draggable","journey-store","require-css!chat-util-css"],function(a,b,c,d,e,f,g,h){var i,j,k=function(){throw"ChatUtilController class cannot be instantiated directly."};d.extend(k.prototype,{initialize:function(a){this._config=a.config,this._chatUrl=a.chatUrl,this._chatWindow=void 0,this._contextChannel=a.contextChannel,this._sessionManager=a.sessionManager,j=a.chatUtilCobrowseManager},showPContentArea:function(){},hidePContentArea:function(){},_commandListener:function(){},destroy:function(){this._contextChannel.removeCommandListener(this._commandListener),i=void 0}});var l=function(){this.initialize.apply(this,arguments)};d.extend(l.prototype,k.prototype,{initialize:function(a){k.prototype.initialize.apply(this,arguments);this._contextChannel.addCommandListener(this._commandListener,this);var b=0,c=0;switch(this._config.windowPosition){case"topleft":b=0,c=0;break;case"topright":b=window.screen.width-this._config.windowWidth,c=0;break;case"bottomleft":b=0,c=window.screen.height-this._config.windowHeight;break;case"bottomright":b=window.screen.width-this._config.windowWidth,c=window.screen.height-this._config.windowHeight}this._chatWindow=parent.window.open(this._chatUrl,this._config.windowName,["width="+this._config.windowWidth,"height="+this._config.windowHeight,"resizable=yes","left="+b,"top="+c].join(",")),this._focus()},_commandListener:function(a,b,c){switch(a){case e.CHAT_COMMAND.CLOSE:c.destroy(),c._contextChannel.deactivate();break;case e.CHAT_COMMAND.UPDATE_CHAT_STATUS:if(b===e.CHAT_STATUS.ON_CHAT){var d=h.getJourneyEncoded();if(d){var f={};f[e.SESSION.JOURNEY]=d,c._contextChannel.sendContext(f)}}}},_focus:function(){try{parent.document.getElementById("sn_iframe")?parent.eval("document.getElementById('sn_iframe').contentWindow.by247.chat.chatWindow.focus()"):window.by247.chat.chatWindow.focus()}catch(a){}}});var m=function(){this.initialize.apply(this,arguments)};d.extend(m.prototype,k.prototype,{initialize:function(a){k.prototype.initialize.apply(this,arguments),this._doc=window.parent.document,this._closeButton=void 0,this._showHideButton=void 0,this._menubarLabel=void 0,this._originalWidth=void 0,this._chatIframe=void 0,this._isMinimize=!!this._sessionManager.get(e.SESSION.MINIMIZED),this._mainChatContainer=void 0,this._chatMenuBar=void 0,this._chatMessageBadge=void 0,this._restrictYAxis="x"===this._config.inPageDragAxis,this._unreadMessageCount=0,this._initOptions=a,this._rightPosition=this._rightOffset();var b=this;if(this._contextChannel.addCommandListener(this._commandListener,this),this._entryExitTimeout=500,d.testCss3Animations()||(this._entryExitTimeout=0),this._mainChatContainer=this._doc.getElementById(this._config.inPageFrameContainerId),!this._mainChatContainer){var g=c.chatinpage({containerId:this._config.inPageFrameContainerId,animate:this._config.channel!==f.CHANNEL.SELFSERVE&&this._config.inPageAnimate.enabled,animateEntry:this._config.inPageAnimate.entry,state:this._getState(this._config.channel),showHideTitle:"Hide Chat",windowTitle:this._config.windowTitle,menubarLabel:this._isMinimize?this._config.windowMinimizedTitle:this._config.windowTitle,closeChatTitle:"Close Chat",chatIframeId:this._config.inPageFrameId,chatIframeSource:"about:blank",chatIframeName:this._config.windowName,chatIframeWidth:this._config.windowWidth+"px",chatIframeHeight:this._config.windowHeight+"px"});d.injectStyleSheet(".by247-chat-position {right: "+this._rightPosition+"px;}",parent.document.getElementsByTagName("head")[0]),this._doc.body.insertAdjacentHTML("beforeend",g),this._mainChatContainer=this._doc.getElementById(this._config.inPageFrameContainerId)}this._chatIframe=this._doc.getElementById(this._config.inPageFrameId),this._closeButton=this._doc.getElementById("by247-chat-menu-close"),this._showHideButton=this._doc.getElementById("by247-chat-menu-show-hide"),this._showHideButtonLabel=this._doc.getElementById("by247-chat-menu-show-hide-label"),this._menubarLabel=this._doc.getElementById("by247-chat-menu-label"),this._chatMenuBar=this._doc.getElementById("by247-chat-menu-bar"),this._chatDragOverlay=this._doc.getElementById("by247-chat-drag-overlay"),this._chatMessageBadge=this._doc.getElementById("by247-chat-message-badge"),d.addSpaceListener([this._showHideButton]),this.makeContainerDraggable(),this._isMinimize&&(this._showHideButton.innerHTML="\u2196"),this._closeButtonListener=function(a){d.stopEvent(a),b._contextChannel.sendCommand(e.CHAT_COMMAND.CLOSE,{src:"chat:closebtn"}),j.disconnectCobrowse()},this._chatMenuBarListener=function(a){d.stopEvent(a);var c=b._config.menubar;b._isMinimize&&c.handlesMaximize&&(!c.handlesDrag||c.handlesDrag&&!b._restrictYAxis)?b._maximizeAnimate():b._isMinimize||!c.handlesMinimize||c.handlesDrag||b._minimizeAnimate()},this._showHideButtonListener=function(a){d.stopEvent(a),b._isMinimize?b._maximizeAnimate():b._minimizeAnimate()},this._windowResizeListener=function(a){d.stopEvent(a),b._mainChatContainer.style.right=b._rightOffset()+"px",b._mainChatContainer.style.bottom="-3px"},this._chatUrlParams=d.parseUrlParams(this._chatUrl,"#"),this._chatIframe.setAttribute("data-uri",encodeURIComponent(JSON.stringify(this._chatUrlParams))),this._chatUrlScript=location.protocol+"//"+this._chatUrlParams.cdnPath+[this._chatUrlParams.key,this._chatUrlParams.pspVersion,this._chatUrlParams.version,this._chatUrlParams.r].join("/"),this._documentDomain=document.domain;var h=!1;try{this._documentHandle=this._chatIframe.contentWindow.document}catch(i){h=!0,this._chatIframe.src=["javascript",":","var d=document.open();d.domain='"+this._documentDomain+"';void(0);"].join(""),this._documentHandle=this._chatIframe.contentWindow.document}this._documentHandle.open()._load=function(a,b){var c=this.createElement("script");h&&(this.domain=a),c.id="js-iframe-async",c.src=b,this.getElementsByTagName("head")[0].appendChild(c)},this._documentHandle.write(["<!DOCTYPE html>","<html>","<head>","</head>","<body onload=\"document._load('"+this._documentDomain+"','"+this._chatUrlScript+"');\">","</body>","</html>"].join("")),this._documentHandle.close()},_getState:function(a){return a===f.CHANNEL.SELFSERVE?"selfserve-hidden":this._isMinimize?"by247-chat-minimized":""},_removeWidget:function(){this._removeListeners(),this.removeChat()},makeContainerDraggable:function(){!0===this._config.menubar.handlesDrag&&(d.addClass(this._chatMenuBar,"draggable"),g.add(this._mainChatContainer,this._chatMenuBar,this._chatDragOverlay,this._restrictYAxis,{right:this._rightPosition,bottom:0}))},removeDraggable:function(){!0===this._config.menubar.handlesDrag&&(this._mainChatContainer.style.bottom="-3px",d.removeClass(this._chatMenuBar,"draggable"),g.remove())},showPContentArea:function(a){this._pcontentOpen=!0,this._pcontentConfig=a,d.injectStyleSheet(".by247-chat-pcontent {width: "+this._widthWithPContent()+"px;}",parent.document.getElementsByTagName("head")[0]),this._chatIframe.setAttribute("width",this._widthWithPContent()+"px"),this._pcontentRight(!0),d.addClass(this._mainChatContainer,"by247-chat-pcontent")},hidePContentArea:function(){this._pcontentOpen=!1,this._pcontentRight(!0),this._chatIframe.setAttribute("width",this._config.windowWidth+"px"),d.removeClass(this._mainChatContainer,"by247-chat-pcontent")},removeChat:function(){this.removeDraggable(),this._removeContainer(),this._contextChannel.deactivate(),this.destroy()},forceClose:function(a){this._contextChannel.sendCommandToSelf(e.CHAT_COMMAND.UPDATE_CHAT_STATUS,e.CHAT_STATUS.WINDOW_CLOSED),this._removeListeners(),this.removeChat(),"function"==typeof a&&a()},removeChatAnimate:function(a){if("beforeunload"===a)this.removeChat();else if(!0!==this._config.inPageAnimate.enabled)this.removeChat();else{this._animateContainer();var b=this;setTimeout(function(){b.removeChat()},this._entryExitTimeout)}},_commandListener:function(a,b,c){switch(a){case e.CHAT_COMMAND.SHOW_PCONTENT:c.showPContentArea(b);break;case e.CHAT_COMMAND.HIDE_PCONTENT:c.hidePContentArea();break;case e.CHAT_COMMAND.CLOSE:c._removeListeners(),c.removeChatAnimate(b.src);break;case e.CHAT_COMMAND.READY:c._setupListeners();break;case e.CHAT_COMMAND.NEW_UNREAD_MESSAGE:c._isMinimize&&c._incrementUnreadMessage();break;case e.CHAT_COMMAND.UPDATE_CHAT_STATUS:if(b===e.CHAT_STATUS.ON_CHAT){var d=h.getJourneyEncoded();if(d){var f={};f[e.SESSION.JOURNEY]=d,c._contextChannel.sendContext(f)}}}},_setupListeners:function(){this._closeButton.addEventListener("click",this._closeButtonListener),this._chatMenuBar.addEventListener("click",this._chatMenuBarListener),this._showHideButton.addEventListener("click",this._showHideButtonListener),parent.window.addEventListener("resize",this._windowResizeListener)},_removeListeners:function(){this._closeButton.removeEventListener("click",this._closeButtonListener),this._chatMenuBar.removeEventListener("click",this._chatMenuBarListener),this._showHideButton.removeEventListener("click",this._showHideButtonListener),parent.window.removeEventListener("resize",this._windowResizeListener)},_maximize:function(){this._showHideButton.innerHTML="\u2198",this._showHideButton.title="Hide Chat",this._showHideButtonLabel.innerHTML="Hide Chat",this._config.channel=this._sessionManager.get(e.SESSION.WORKFLOW)||this._config.channel,this._config.channel!==f.CHANNEL.SELFSERVE&&(this._menubarLabel.innerHTML=this._config.windowTitle),d.addClass(this._mainChatContainer,"by247-chat-maximized"),d.removeClass(this._mainChatContainer,"by247-chat-minimized"),this._pcontentRight(!1),this._animateContainer(!0),this._contextChannel.sendCommand(e.CHAT_COMMAND.MAXIMIZE),this._restrictYAxis||this.makeContainerDraggable(),this._clearUnreadMessage(),this._isMinimize=!1},_maximizeAnimate:function(){if(!0!==this._config.inPageAnimate.enabled)this._maximize();else{this._animateContainer();var a=this;setTimeout(function(){a._maximize()},this._entryExitTimeout)}},_minimize:function(){this._showHideButton.innerHTML="\u2196",this._showHideButton.title="Show Chat",this._showHideButtonLabel.innerHTML="Show Chat",this._config.channel=this._sessionManager.get(e.SESSION.WORKFLOW)||this._config.channel,this._config.channel!==f.CHANNEL.SELFSERVE&&(this._menubarLabel.innerHTML=this._config.windowMinimizedTitle),d.addClass(this._mainChatContainer,"by247-chat-minimized"),d.removeClass(this._mainChatContainer,"by247-chat-maximized"),this._restrictYAxis||this.removeDraggable(),d.removeClass(this._mainChatContainer,"by247-chat-pcontent"),this._pcontentOpen=!1,this._pcontentRight(!1),this._animateContainer(!0),this._contextChannel.sendCommand(e.CHAT_COMMAND.MINIMIZE),this._isMinimize=!this._isMinimize},_minimizeAnimate:function(){if(!0!==this._config.inPageAnimate.enabled)this._minimize();else{this._animateContainer();var a=this;setTimeout(function(){a._minimize()},this._entryExitTimeout)}},_animateContainer:function(a){!0===this._config.inPageAnimate.enabled&&(!0===a?(d.removeClass(this._mainChatContainer,this._config.inPageAnimate.exit),d.addClass(this._mainChatContainer,this._config.inPageAnimate.entry)):(d.removeClass(this._mainChatContainer,this._config.inPageAnimate.entry),d.addClass(this._mainChatContainer,this._config.inPageAnimate.exit)))},_removeContainer:function(){this._mainChatContainer&&(this._chatIframe.parentNode.removeChild(this._chatIframe),this._doc.body.removeChild(this._mainChatContainer),this._mainChatContainer=null),this._chatIframe=null},_incrementUnreadMessage:function(){d.show(this._chatMessageBadge),this._unreadMessageCount++;var a=this._unreadMessageCount;a>99&&(a="99"),this._chatMessageBadge.innerHTML=a},_clearUnreadMessage:function(){this._unreadMessageCount=0,this._chatMessageBadge.innerHTML="",d.hide(this._chatMessageBadge)},_rightOffset:function(){var a=this._config.inPageOffset;return"bottomleft"==this._config.windowPosition&&(a=this._doc.documentElement.clientWidth-this._config.windowWidth-this._config.inPageOffset,this._pcontentOpen&&(a-=this._widthPContent())),a},_pcontentRight:function(a){var b=this._pcontentConfig,c=this._doc.documentElement.clientWidth,d=this._mainChatContainer,e=this._mainChatContainer.getBoundingClientRect(),f=c-e.right,g=(e.left,this._config.windowWidth);b&&("right"===b.position?this._pcontentOpen?f-=this._widthPContent():a&&(f+=this._widthPContent()):"left"===b.position&&this._pcontentOpen&&(g=this._widthWithPContent()),d.style.right=Math.min(Math.max(0,f),c-g)+"px")},_widthWithPContent:function(){return(this._pcontentConfig.ratio+1)*this._config.windowWidth},_widthPContent:function(){return this._pcontentConfig.ratio*this._config.windowWidth}});var n=function(b){return a.isObject(b,"options"),a.isObject(b.config,"options.config"),a.notEmpty(b.chatUrl,"options.chatUrl"),a.isObject(b.contextChannel,"options.contextChannel"),a.isObject(b.sessionManager,"options.sessionManager"),i&&b.contextChannel.constructor===d.noop&&p(),b.config.inPage?i?i._isMinimize&&i._maximize():i=new m(b):i?i._focus():i=new l(b),i},o=function(){return i},p=function(){a.assert(i,"not initialized"),i.destroy()};return{init:n,get:o,destroy:p}}),c("chat-util-session-manager",["assert","utils","chat-context-constants","module","chat-util-constants"],function(a,b,c,d,e){var f,g=d.config(),h=g.sessionKeyPrefix,i=h+"-session",j=h+"-session-",k=g.sessionReconcileMethod,l=function(){this.initialize.apply(this,arguments)};return b.extend(l.prototype,{initialize:function(b){a.assert(!f,"already initialized!"),this._contextChannel=b.contextChannel,this._sessionId=b.storageId,this._storage=b.storage,this._inPage=b.inPage,this._contextChannel.addCommandListener(this._onCommand,this),k==c.SESSION.RECONCILE_METHOD.WINDOW_NAME&&this._retrieveSessionFromWindowName()},destroy:function(){this._contextChannel.removeCommandListener(this._onCommand),f=void 0},_onCommand:function(b,d,e){switch(b){case c.CHAT_COMMAND.UPDATE_SESSION:if(a.isObject(d,"data"),d.state==c.SESSION.STATES.POSTCHAT&&e.get("state")==c.SESSION.STATES.POSTCHAT)return;e._setSessionData(d);break;case c.CHAT_COMMAND.UPDATE_CHAT_STATUS:d===c.CHAT_STATUS.WINDOW_OPENED?e._widgetShown=!0:d===c.CHAT_STATUS.WINDOW_CLOSED&&(e._widgetShown=!1);break;case c.CHAT_COMMAND.CLOSE:d&&"beforeunload"===d.src&&k==c.SESSION.RECONCILE_METHOD.WINDOW_NAME&&e._saveSessionInWindowName()}},_saveSessionInWindowName:function(){var a=this._getSessionData();void 0!==a&&(a.previousWindowName=parent.window.name,parent.window.name=JSON.stringify(a))},_retrieveSessionFromWindowName:function(){var a;try{a=JSON.parse(parent.window.name)}catch(b){a={},a.previousWindowName=""}parent.window.name=a.previousWindowName,delete a.previousWindowName,this._setSessionData(a)},_setSessionData:function(c){if(a.isObject(c,"data"),c.id=c.id||this._sessionId,c.id){var d=this._storage.getItem(i);d?-1===d.indexOf(c.id)&&(d=d+","+c.id,this._storage.setItem(i,d)):this._storage.setItem(i,c.id);var e=this._storage.getItem(j+c.id);e=e?JSON.parse(e):{},this._storage.setItem(j+c.id,JSON.stringify(b.extend(e,c)))}},_getSessionData:function(){var a,b=this._storage.getItem(i);if(b&&-1!==b.indexOf(this._sessionId)){try{var c=JSON.parse(this._storage.getItem(j+this._sessionId));c.id&&b.indexOf(c.id)>-1&&(a=c)}catch(d){}return a}},clearSessionData:function(){var a=this._storage.getItem(i);if(a){a=a.split(",");for(var b=[],d=0;d<a.length;d++)a[d]!==this._sessionId&&b.push(a[d]);b=b.join(","),""===b?this._storage.removeItem(i):this._storage.setItem(i,b),this._storage.removeItem(j+this._sessionId)}k==c.SESSION.RECONCILE_METHOD.WINDOW_NAME&&(parent.window.name="")},canReconcile:function(){var a=this._getSessionData(),b=!1;if(a){var d=a.maxReconcileIntervalMsec||6e5,e=(new Date).getTime(),f=!this._inPage||a.state===c.SESSION.STATES.CHATTING||a.state===c.SESSION.STATES.RECONCILING||a.state===c.SESSION.STATES.CHAT_REQUESTED;a.updated&&e-a.updated<=d&&f&&(b=!0),b||(this.clearSessionData(),this._contextChannel._onContextUpdate({chatStatus:c.CHAT_STATUS.WINDOW_CLOSED}))}return b},isInteractionActive:function(){return this._widgetShown||this.canReconcile()},canCobrowseReconcile:function(){var a=this._getSessionData(),b=!1;return a&&a.cobrowsestate===e.COBROWSE.STATES.JOINED&&(b=!0),b},getCobrowseSessionData:function(){var a=this._getSessionData();return!!a&&{cobrowseId:a.cobrowseid,cobrowseMode:a.cobrowsemode,screenshareUrl:a.screenshareUrl}},get:function(a){var b=this._getSessionData();return a?b?b[a]:void 0:b},set:function(c,d){if("object"==typeof c)a.assert(void 0===d,"key is object and value is not undefined"),this._setSessionData(c);else{var e=this._getSessionData(),f={};f[c]=d,this._setSessionData(b.extend(e,f))}}}),{init:function(b){return a.assert(!f,"already initialized!"),a.isObject(b,"contextChannel"),f=new l(b)},destroy:function(){a.assert(f,"not initialized"),f.destroy()}}}),c("chat-util-cobrowse-manager",["assert","utils","module","chat-util-constants","chat-context-constants"],function(a,b,c,d,e){var f,g,h,i,j=c.config(),k=parent,l=function(){this.initialize.apply(this,arguments)};return b.extend(l.prototype,{initialize:function(a){if(g=a.contextChannel,h=a.sessionManager,i=a.inPage,a.cobrowseSessionTimeout&&(j.cobrowseSessionTimeout=a.cobrowseSessionTimeout),h.canCobrowseReconcile()){var b=h.getCobrowseSessionData();b&&this.resumeCobrowse(b)}g.addCommandListener(this._commandListener,this)},_commandListener:function(a,c,f){var g=h.getCobrowseSessionData();switch(a){case e.CHAT_COMMAND.CLOSE:i||f.disconnectCobrowse();break;case d.COBROWSE.STATES.INITIALIZED:
b.injectScript(g.screenshareUrl,null,k.document,{id:"screenshare"});break;case d.COBROWSE.STATES.STARTED:f.start247SessionAsync(g.cobrowseMode,15);break;case d.COBROWSE.STATES.ENDED:f.disconnectCobrowse()}},urlSendCallBack:function(b){a.notEmpty(b,"urlSendCallBack:data"),g.sendCommand(d.COBROWSE.STATES.INITIALIZED,b)},userDataSaveCallBack:function(b){a.isObject(b,"userDataSaveCallBack:data"),g.sendCommand(d.COBROWSE.STATES.STARTED,b)},start247SessionAsync:function(a,b){var c=this;"boolean"==typeof k.isInit&&!0===k.isInit?"cobrowse"===a?k.CreateSession("cobrowse",this.urlSendCallBack,this.userDataSaveCallBack,null,j.cobrowseSessionTimeout):"coview"===a&&k.CreateSession("coview",this.urlSendCallBack,this.userDataSaveCallBack,null,j.cobrowseSessionTimeout):0===b||setTimeout(function(){c.start247SessionAsync(a,--b)},1e3)},continue247SessionAsync:function(b,c){var d=this;a.notEmpty(b,"continue247SessionAsync:data"),"boolean"==typeof k.isInit&&!0===k.isInit?k.ContinueSession(b):0===c||setTimeout(function(){d.continue247SessionAsync(b,--c)},1e3)},disconnectCobrowse:function(){k&&k.disconnect&&k.disconnect()},resumeCobrowse:function(a){b.injectScript(a.screenshareUrl,null,k.document,{id:"screenshare"});var c=a.cobrowseId+";"+a.cobrowseMode;this.continue247SessionAsync(c,15)}}),{init:function(b){return a.assert(!f,"already initialized!"),a.isObject(b.contextChannel,"contextChannel"),a.isObject(b.sessionManager,"sessionManager"),f=new l(b)},destroy:function(){a.assert(f,"not initialized"),f.destroy()}}}),c("logger/chat-util",["assert","utils","chat-util-constants","chat-context-constants"],function(a,b,c,d){function e(a,b,c){f.sendEventToContext({eventId:a,data:b||{}})}var f,g=function(a){this.initialize.apply(this,arguments)};b.extend(g.prototype,{initialize:function(a){this._contextChannel=a.contextChannel,this._sessionManager=a.sessionManager,this._appId=a.appId,this._parentUrl=b.getOriginFromUrl(window.parent.location.href),this._contextChannel.addCommandListener(this._onCommand,this)},sendEventToContext:function(a){var b={};b[d.CHAT_COMMAND.TRACK_EVENT]=a,this._contextChannel._onContextUpdate(b)},inviteEvent:function(b,c){a.isObject(c,"data"),e(b,{f:{o:{ii:c.clid,it:c.type,id:this._appId},p:{cp:this._parentUrl},v:{ri:c.ruleId,rc:c.type},a:{qu:c.queue,sk:c.skill}},ed:c.ed})},_chatEvent:function(a){var b,c=this._sessionManager.get();c&&(b={clid:c.clid,ruleId:c.ruleId,queue:c.queue,rc:c.rc}),b&&e(a,{f:{o:{ii:b.clid,it:b.rc,id:this._appId},p:{cp:this._parentUrl},v:{ri:b.ruleId,rc:b.rc},a:{qu:b.queue}},ed:{workflow:this.getWorkflow()}})},setWorkflow:function(a){this._workflow=a},getWorkflow:function(){return this._sessionManager.get(d.SESSION.WORKFLOW)||this._workflow},_onCommand:function(a,b,e){switch(a){case d.CHAT_COMMAND.UPDATE_CHAT_STATUS:b===d.CHAT_STATUS.WINDOW_CLOSED&&(e._chatEvent(c.LOGEVENTS.APP_ENDED),e._sessionManager.clearSessionData())}}});var h=function(){a(f,"not initialized"),f=void 0};return{init:function(b){return a.assert(!f,"already initialized!"),a.isObject(b.contextChannel,"contextChannel"),f=new g(b)},destroy:h}}),c("chat-util-notify",["assert","handlebars","chatutiltemplate","utils","chat-context-constants","require-css!chat-util-css"],function(a,b,c,d,e){var f,g=function(){this.initialize.apply(this,arguments)};return d.extend(g.prototype,{initialize:function(a){this._config=a.config,this._contextChannel=a.contextChannel;var b=this;if(this._contextChannel.addCommandListener(this._commandListener,this),this._doc=window.parent.document,this._menubarLabel=void 0,this._originalWidth=void 0,this._mainNotifyContainer=void 0,this._chatMenuBar=void 0,this._chatMessageBadge=void 0,this._chatQuickPeek=void 0,this._unreadMessageCount=0,this._initOptions=a,this._mainNotifyContainer=this._doc.getElementById(this._config.inPageFrameContainerId),!this._mainNotifyContainer){var e=c.chatnotify({containerId:this._config.inPageFrameContainerId,position:this._config.windowPosition,width:this._config.windowWidth,closeChatTitle:"Close Chat",menubarLabel:this._config.windowTitle});d.injectStyleSheet(".by247-chat-menu-bar {background: "+this._config.menubar.backgroundColor+";color: "+this._config.menubar.foregroundColor+";}.by247-chat-message-badge {left: 0;}.by247-bottomleft, .by247-topleft {right: "+(this._doc.documentElement.clientWidth-this._config.windowWidth-this._config.inPageOffset)+"px;}.by247-bottomright, .by247-topright {right: "+this._config.inPageOffset+"px;}",parent.document.getElementsByTagName("head")[0]),this._doc.body.insertAdjacentHTML("beforeend",e)}this._mainNotifyContainer=this._doc.getElementById(this._config.inPageFrameContainerId),this._chatMessageBadge=this._doc.getElementById("by247-chat-message-badge"),this._closeButton=this._doc.getElementById("by247-chat-menu-close"),this._chatQuickPeek=this._doc.getElementById("by247-chat-quick-peek"),d.hide(this._mainNotifyContainer),d.addClass(this._mainNotifyContainer,"animated"),this._closeButtonListener=function(a){a.preventDefault(),a.stopPropagation(),b._hideNotify()},this._closeButton.addEventListener("click",this._closeButtonListener),this._windowResizeListener=function(a){d.stopEvent(a),b._mainNotifyContainer.style.right=b._doc.documentElement.clientWidth-b._config.windowWidth-b._config.inPageOffset+"px"},parent.window.addEventListener("resize",this._windowResizeListener)},remove:function(){this._closeButton.removeEventListener("click",this._closeButtonListener),parent.window.removeEventListener("resize",this._windowResizeListener),this._mainNotifyContainer.parentNode.removeChild(this._mainNotifyContainer)},_commandListener:function(a,b,c){switch(a){case e.CHAT_COMMAND.NEW_UNREAD_MESSAGE:c._handleUnreadMessage(b);break;case e.CHAT_COMMAND.CLOSE:c.remove()}},_handleUnreadMessage:function(a){this.unreadPid&&window.clearTimeout(this.unreadPid),this._chatQuickPeek.innerHTML=c.chatnotifymessage(a);var b=this;this.unreadPid=window.setTimeout(function(){b._hideNotify(),b._clearUnreadMessage()},this._config.quickPeek.timeout),this._showNotify(),this._incrementUnreadMessage()},_incrementUnreadMessage:function(){d.show(this._chatMessageBadge),this._unreadMessageCount++;var a=this._unreadMessageCount;a>99&&(a="99"),this._chatMessageBadge.innerHTML=a,this._addEffect(this._config.quickPeek.effect)},_clearUnreadMessage:function(){this._unreadMessageCount=0,this._chatMessageBadge.innerHTML="",d.hide(this._chatMessageBadge)},_hideNotify:function(){this._addEffect("fadeOut")},_showNotify:function(){d.show(this._mainNotifyContainer),this._addEffect(this._config.quickPeek.effect)},_addEffect:function(a){d.addClass(this._mainNotifyContainer,a);var b=this;window.setTimeout(function(){"fadeOut"===a&&d.hide(b._mainNotifyContainer),d.removeClass(b._mainNotifyContainer,a)},1100)}}),{init:function(b){return a.isObject(b,"options"),a.isObject(b.config,"options.config"),a.isObject(b.contextChannel,"options.contextChannel"),b.config.inPage||b.contextChannel.constructor===d.noop||(f=new g(b)),f},destroy:function(){f.remove()}}}),c("xdsync-store",["utils","chat-util-constants","xd-communication-utils"],function(a,b,c){var d=window.localStorage;return{setItem:function(a,b){try{d.setItem(a,b),c.isXdCommunicationEnabled()&&c.setItem(a,b)}catch(e){}},getItem:function(a){return d.getItem(a)},removeItem:function(a){d.removeItem(a),c.isXdCommunicationEnabled()&&c.removeItem(a)}}}),c("configuration-manager",["utils","chat-util-constants"],function(a,b){var c,d={},e="default",f=function(){this.initialize.apply(this,arguments)};a.extend(f.prototype,{initialize:function(a,b){this._origin=a,this._attributes=b,this._initCallback=b&&b},destroy:function(){d={}},get:function(b){var c=b||e,f=d[c];return f?a.extend({},f):void 0},set:function(a){var b=this._normalize(a);b.appId&&(d[b.appId]=b),d[e]||(d[e]=b)},fetch:function(b){var c=b||e;if(this._hasRemoteConfig()){var d=this._getConfigUrl(c);a.injectScript(d,null,document,{id:"initconfig_"+c})}},_hasRemoteConfig:function(){return!(!this._origin||!this._attributes)},_getConfigUrl:function(a){var c=this._attributes[b.DATA_ATTRIBUTES.CONFIGROOT],d=this._attributes[b.DATA_ATTRIBUTES.CLIENTKEY],e=this._attributes[b.DATA_ATTRIBUTES.CALLBACK];return c||(c=[this._origin,b.CONTENT_PATH,d].join("/")),[c,a,b.INIT_CONFIG].join("/")+(e?"?cb="+e:"")},_normalize:function(a){var b=a||{};return b.prechatData&&b.prechatData.queue&&(b.workflowConfig.assistQueue=b.prechatData.queue),b}});var g=function(a,b){return c=new f(a,b)},h=function(){return c||g()};return{init:g,destroy:function(){c&&c.destroy(),c=void 0},getInstance:h}}),c("chat-util-init",["utils","assert","chat-util-constants","xdsync-store","xd-communication-utils","journey-store","configuration-manager"],function(a,b,c,d,e,f,g){var h,i=function(){this.initialize.apply(this,arguments)};return a.extend(i.prototype,{initialize:function(d){var f=document.getElementById(c.CHAT_UTIL_ELEMENT_ID);if(f&&f.src&&(this._attributes=this._extractAttributes(f),this._attributes.auto&&"false"!=this._attributes.auto)){var g=this._attributes[c.DATA_ATTRIBUTES.CLIENTKEY];b.notEmpty(g,"key");var h=a.parseUrl(f.src).replaceResource("xd.html").appendToHash({origin:location.protocol+"//"+location.hostname,namespace:g},void 0,!0).secure();this._origin=h.origin;var i={xdUrlObject:h,callback:this._onXdCommunicatorInit,thisArg:this};e.init(i)}},_extractAttributes:function(a){var b={};for(var d in c.DATA_ATTRIBUTES)if(c.DATA_ATTRIBUTES.hasOwnProperty(d)){var e=c.DATA_ATTRIBUTES[d],f=a.getAttribute("data-"+e);f&&(b[e]=f)}return b},_setSessionData:function(a){var b,e=c.SESSION_KEY;if(a&&a[e]&&(b=a[e])){d.setItem(e,b);for(var f=b.split(","),g=0;g<f.length;g++)try{var h=e+"-"+f[g],i=a[h];d.setItem(h,i)}catch(j){}}},_onXdCommunicatorInit:function(a){this._setSessionData(a),f.init(a),g.init(this._origin,this._attributes).fetch(this._attributes.appId)}}),{init:function(a){return b.assert(!h,"already initialized!"),h=new i(a)}}}),c("chat-invites",["utils"],function(a){return window._tfs&&window._tfs.invites?window._tfs.invites:{init:a.noop,setInteractionActive:a.noop,triggerInvite:a.noop,removeInvite:a.noop}}),c("chat-util-tab-manager",["assert","utils","chat-context-constants","chat-util-constants","module"],function(a,b,c,d,e){var f,g=function(){this.initialize.apply(this,arguments)};b.extend(g.prototype,{initialize:function(a){this._config=a.config,this._contextChannel=a.contextChannel,this._sessionManager=a.sessionManager,this._controller=a.controller,this._storageKey=e.config().tabKeyPrefix,this._storage=a.storage,this._contextChannel.addCommandListener(this._commandListener,this),this._endChatTimeIntervalHandle=void 0,this._endChatCheckTimeout=2e3,this._userEndedChatInThisTab=!1},_commandListener:function(b,e,f){switch(b){case c.CHAT_COMMAND.USER_ENDED_CHAT:f._clearForChatEnd();var g={};g[d.USER_ENDED_CHAT]=!0,f._storage.setItem(f._storageKey,JSON.stringify(g)),f._userEndedChatInThisTab=!0;break;case c.CHAT_COMMAND.UPDATE_SESSION:if(a.isObject(e,"data"),e.state===c.SESSION.STATES.CHATTING&&!f._endChatTimeIntervalHandle){var h={};h[d.USER_ENDED_CHAT]=!1,f._storage.setItem(f._storageKey,JSON.stringify(h)),f._clearForChatEnd(),f._pollForChatEnd(),f._userEndedChatInThisTab=!1}break;case c.CHAT_COMMAND.UPDATE_CHAT_STATUS:e===c.CHAT_STATUS.WINDOW_CLOSED&&f._userEndedChatInThisTab&&f._removeTabData()}},_pollForChatEnd:function(){var a=this;this._endChatTimeIntervalHandle=setTimeout(function(){var b;try{b=a._storage.getItem(a._storageKey),b=JSON.parse(b)}catch(e){}b&&!0===b[d.USER_ENDED_CHAT]?(a._contextChannel.sendCommand(c.CHAT_COMMAND.AUTO_CLOSE),a._controller._removeWidget()):a._pollForChatEnd()},this._endChatCheckTimeout)},_clearForChatEnd:function(){this._endChatTimeIntervalHandle&&clearInterval(this._endChatTimeIntervalHandle)},_removeTabData:function(){this._storage.removeItem(this._storageKey)},destroy:function(){this._contextChannel.removeCommandListener(this._commandListener),this._removeTabData(),f=void 0}});var h=function(b){return a.isObject(b,"options"),a.isObject(b.config,"options.config"),a.isObject(b.contextChannel,"options.contextChannel"),a.isObject(b.sessionManager,"options.sessionManager"),a.isObject(b.controller,"options.controller"),f&&j(),f=new g(b)},i=function(){return f},j=function(){a.assert(f,"not initialized"),f.destroy()};return{init:h,get:i,destroy:j}}),function(b){a.config({config:{"chat-util":{chatUrl:null,appId:"default",customParams:{},encodeCustomParams:!1,onContextUpdate:null,onStateChange:"",windowTitle:"Chat",windowMinimizedTitle:"Back to chat",windowName:"chat",windowHeight:539,windowWidth:300,menubar:{backgroundColor:"#999999",foregroundColor:"#ffffff",handlesMinimize:!0,handlesMaximize:!0,handlesDrag:!1},windowPosition:"topleft",inPage:!1,inPageDragAxis:"x",inPageOffset:30,inPageAnimate:{enabled:!0,entry:"slideInUp",exit:"slideOutDown"},inPageFrameId:"by247ChatFrame",inPageFrameContainerId:"by247-chat-frame-container",quickPeek:{enabled:!1,timeout:5e3,effect:"bounce"},storageId:"ou812",storage:null,startChatImmediately:!0,customCSSText:null,channel:null,supportHours:[{queue:"default",sunday:[{start:"0000",end:"2359"}],monday:[{start:"0000",end:"2359"}],tuesday:[{start:"0000",end:"2359"}],wednesday:[{start:"0000",end:"2359"}],thursday:[{start:"0000",end:"2359"}],friday:[{start:"0000",end:"2359"}],saturday:[{start:"0000",end:"2359"}]}],timeZoneOffset:0,timeZoneName:"UTC",invites:[]},"context-channel":{name:null,sourceKey:"by247-chat-context-channel-parent",destKey:"by247-chat-context-channel-chat",proxyFrameId:"by247ContextChannelFrame",pxoeFrameId:"sn_iframe",forceCrossOrigin:!1,waitForPeer:!0,proxyUrl:null,sourceOrigin:null,destOrigin:null,onContextUpdate:null,socketioPath:"//cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js",contextServer:"cobrowseserver"},"chat-util-cobrowse-manager":{cobrowseSessionTimeout:6e5},"chat-util-session-manager":{sessionKeyPrefix:"by247-chat",sessionReconcileMethod:"pxoe"},"chat-util-tab-manager":{tabKeyPrefix:"by247-chat-tab"},"require-css!chat-util-css":{id:"by247-chat-util-stylesheet",injectToParentWindow:!0}},paths:{handlebars:"../lib/handlebars/handlebars.runtime",chatutiltemplate:"../chat-util-template","require-css":"../lib/require-css/css.min","css-builder":"../lib/require-css/css-builder",normalize:"../lib/require-css/normalize","chat-util-css":"../css/chat-util.min"}}),c("chat-util",["assert","context-channel","module","utils","chat-util-constants","chat-util-controller","chat-util-session-manager","chat-util-cobrowse-manager","chat-context-constants","logger/chat-util","chat-util-notify","chat-util-init","xdsync-store","journey-store","chat-invites","chat-util-tab-manager","configuration-manager"],function(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t,u,v,w,x,y,z,A,B=!1,C={},D=function(b){var g=e.extend({},d.config(),b);if(g.inPage&&(g.windowPosition=b.windowPosition||"bottomright"),A=r.getInstance(),g.initParams?g.appId=g.initParams.appid||g.initParams.appId||g.appId:g.appId=g.customParams.appid||g.customParams.appId||g.appId,A.set(g),!B){if(a.notEmpty(g.chatUrl,"config.chatUrl"),g.inPage||a.assert(0===e.normalizeUrl(g.chatUrl).indexOf("https:"),"config.chatUrl is not secure for popout chat."),g.contextProxyUrl){var m=e.parseUrl(g.chatUrl),q=e.parseUrl(g.contextProxyUrl);a.assert(m.host===q.host,"chatUrl "+g.chatUrl+" and contextProxyUrl ",g.contextProxyUrl+"must use same domain and port")}var s={name:j.WINDOW_NAME.PARENT,sourceOrigin:e.getOriginFromUrl(window.location),destOrigin:e.getOriginFromUrl(g.chatUrl),onContextUpdate:"function"==typeof g.onContextUpdate?g.onContextUpdate:void 0,onStateChange:e.getFunctionReference(g.onStateChange),contextServer:g.contextServer,inPage:g.inPage,forceCrossOrigin:g.forceCrossOrigin,proxyUrl:g.contextProxyUrl};if(x=c.make(s),!e.testLocalStorage()&&!g.storage)return B;u=h.init({contextChannel:x,storageId:g.storageId,storage:g.storage||n,inPage:g.inPage}),v=i.init({contextChannel:x,sessionManager:u,inPage:g.inPage,cobrowseSessionTimeout:g.cobrowseSessionTimeout}),y=k.init({contextChannel:x,sessionManager:u,appId:g.appId});var t=function(a){var b=(new Date).getTime(),c={},d=f.INVITE.SESSION_KEYS;u.get(d.STATE)||(c[d.STATE]=j.SESSION.STATES.INVITE_ACCEPTED),c[d.CREATED]=b,c[d.UPDATED]=b,c[d.INVITEID]=a.inviteId,c[d.RULEID]=a.ruleId,c[d.RC]="maximized"===a.state?"p":"b",c[d.CLID]=a.appInteractionId,c[d.APPID]=a.appId,u.set(c)},w=function(a){var b=a.appInteractionId,c=a.ruleId,d=a.queue,f=a.state,g=a.inviteId,h=(a.triggerAppId,a.trackingId),i=a.appId,j=e.getObjectWithoutProperties(a,["appInteractionId","ruleId","queue","state","inviteId","triggerAppId","trackingId","appId"]);return{initParams:e.extend({psid:b,sc:c,queue:d,rc:"maximized"===f?"p":"b",btnName:g,btnTyp:g,trackingId:h},j),appId:i}},D=function(a){t(a),p.setInteractionActive(!0),E(w(a))},F=function(a){var b={inviteOffered:"11103",inviteAccepted:"11104",inviteDeclined:"11105",inviteIgnored:"11106"},c=b[a.event];if(void 0!==c){var d=a.eventData,f=d.appInteractionId,g=d.ruleId,h=d.queue,i=d.skill,j=d.state,k=e.getObjectWithoutProperties(d,["appInteractionId","ruleId","queue","skill","state"]),l={clid:f,type:"maximized"===j?"p":"b",ruleId:g,queue:h,skill:i,ed:k};y.inviteEvent(c,l)}},G=function(a){x._onContextUpdate(a)};p.init(g,{startInteraction:D,logEvent:F,device:"desktop",onStateChange:G});var I=[j.SESSION.STATES.RECONCILING,j.SESSION.STATES.CHAT_REQUESTED,j.SESSION.STATES.CHATTING],J=u.get("state");if(J&&I.indexOf(J)>-1&&p.setInteractionActive(!0),x.addCommandListener(function(a,b,c){a==j.CHAT_COMMAND.UPDATE_CHAT_STATUS&&(b===j.CHAT_STATUS.WINDOW_OPENED?p.setInteractionActive(!0):b===j.CHAT_STATUS.WINDOW_CLOSED&&p.setInteractionActive(!1))},this),g.quickPeek.enabled&&(z=l.init({config:g,contextChannel:x})),B=!0,g.startChatImmediately||u&&u.canReconcile()&&g.inPage){var K=u.get(f.INVITE.SESSION_KEYS.APPID);A.get(K)?E({appId:K}):(C[K]||(C[K]=[]),C[K].push({reason:f.FETCH_REASON.RECONCILE}),A.fetch(K))}if("function"==typeof g.onInitDone&&g.onInitDone(),u.get("state")==j.SESSION.STATES.CHATTING){var L=o.getJourneyEncoded();if(L){var M={};M[j.SESSION.JOURNEY]=L,x.sendContext(M)}}return B}var N=C[g.appId];if(N){for(var O=0;O<N.length;O++){var P=N[O];P.reason==f.FETCH_REASON.RECONCILE?E({appId:g.appId}):P.reason==f.FETCH_REASON.INVITE&&H(P.additionalConfig,P.triggerConfig)}C[g.appId]=[]}},E=function(c){if(!parent.document.body||!parent.document.body.insertAdjacentHTML)return void setTimeout(function(){E(c)},200);a.assert(B,"chat-util was not initialized"),c=c||{};var d=c.appId,f=A.get(d),h=".by247-chat-menu-bar {background: "+f.menubar.backgroundColor+";color: "+f.menubar.foregroundColor+";}"+(f.customCSSText?f.customCSSText:"");e.injectStyleSheet(h,parent.document.getElementsByTagName("head")[0]),x.load&&x.load();var i=e.extend({},f.initParams,c.initParams),k=e.extend({},f.customParams,c.customParams);k.parentUrl=e.getOriginFromUrl(window.parent.location.href),k.windowTitle=f.windowTitle,x.usesWebsocket()&&(k.contextSessionId=x.getContextSessionId()),s=e.appendUrlParams(f.chatUrl,k,"#",f.encodeCustomParams),f.channel=f.channel||u.get(j.SESSION.WORKFLOW),y.setWorkflow(f.channel);var l={session:e.extend({},u.get(),{workflow:f.channel}),initParams:i};if(f.inPage||!f.inPage&&u.get("state")===j.SESSION.STATES.INVITE_ACCEPTED){var m=e.generateSecureWindowName(l);e.extend(f,{windowName:m})}else e.extend(f,{windowName:"chat"});t=g.init({config:f,chatUrl:s,contextChannel:x,sessionManager:u,chatUtilCobrowseManager:v}),w=q.init({config:f,contextChannel:x,sessionManager:u,controller:t,storage:f.storage||n}),b.by247.chat.chatWindow=t._chatWindow},F=function(b){a.assert(void 0!==b,"data is undefined"),x.sendContext(b)},G=function(b,c){a.notEmpty(b,"command"),x.sendCommand(b,c)},H=function(a,b){if(B){if(!b)return void E(a);var c=b.appId,d=A.get(c);d?(d.initParams=e.extend({},d.initParams,a.prechatData),A.set(d),p.triggerInvite(d,b)):(C[c]||(C[c]=[]),C[c].push({additionalConfig:a,triggerConfig:b,reason:f.FETCH_REASON.INVITE}),A.fetch(c))}},I=function(a){return p.removeInvite(a)},J=function(){return u.isInteractionActive()},K={version:"1.7.7",releaseTag:"chat-1.7.7",init:D,startChat:E,sendContextToChat:F,sendCommandToChat:G,startInteraction:H,endInteraction:I,isInteractionActive:J};return b.by247=b.by247||{},b.by247.chat=b.by247.chat||{},e.extend(b.by247.chat,K),m.init(),b.by247.chat._readyCallback&&b.by247.chat._readyCallback(),K}),b.by247=b.by247||{},b.by247.chat=b.by247.chat||{},b.by247.chat.ready=function(a){"function"==typeof a&&(this._readyCallback=a,this.init&&this._readyCallback())}}(window),b(["chat-util"])}();
//# sourceMappingURL=chat-util.min.js.map
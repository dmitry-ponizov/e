define(["require","exports","angular"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e[e.ADD_EXT_ACCT=0]="ADD_EXT_ACCT",e[e.CONVERT_EXT_ACCT=1]="CONVERT_EXT_ACCT",e[e.VC_REVEAL_16_DIGIT=2]="VC_REVEAL_16_DIGIT",e[e.ACCT_SETUP=3]="ACCT_SETUP"}(r||(r={}));var i="OTP",o="Web",a="SECAUTH",_=function(){function e(e,t,n,_,s,l,E,T){var C=this;this.$window=e,this.OTP_CONFIG=t,this.EaseCoreRestangular=n,this.EaseConstantFactory=_,this.$q=s,this.EaseConstant=l,this.environmentUtils=E,this.pubsubService=T,this.goToOtpForFeature=function(e,t,n){var i=function(r){r&&r.appropriateLevel?o.resolve(r):C.navigateToChallengeApp(e,t,n)},o=C.$q.defer();return r&&r[e]&&C.OTP_FEATURE_TO_CONFIG&&C.OTP_FEATURE_TO_CONFIG[r[e]]?C._isAppropriateLevel(C.OTP_FEATURE_TO_CONFIG[r[e]].level,C.OTP_FEATURE_TO_CONFIG[r[e]].fallbackLevel).then(i,o.reject)["catch"](o.reject):o.reject(),o.promise},this.hasUserCorrectOtpLevel=function(e){var t=C.OTP_FEATURE_TO_CONFIG[r[e]].level,n=C.OTP_FEATURE_TO_CONFIG[r[e]].fallbackLevel;return C._isAppropriateLevel(t,n).then(function(e){if(e&&"appropriateLevel"in e)return e.appropriateLevel;throw Error()})},this.decodeQueryParams=function(e){var t={};e=decodeURIComponent(e);for(var n=e.split("&"),r=0,i=n;r<i.length;r++){var o=i[r],a=o.split("=");t[a[0]]=decodeURIComponent(decodeURIComponent(a[1]))}return t},this.navigateToChallengeApp=function(e,t,n){C.pubsubService.pubsubTrackAnalytics({challengeApp:"pre"}),C.$window.location.href=C._buildChallengeAppUrl(C._determineOTPClientEnvironment(e),t,n)},this._buildChallengeAppUrl=function(e,t,n){void 0===n&&(n=i);var r=[""+C.CHALLENGE_APP_BASE_URL,"?client="+e,"&channelType="+o,"&eventType="+a,"&challengeMethod="+n];if(t)if(t instanceof Array)for(var _ in t)r.push("&dp_"+(+_+1)+"="+t[_]);else r.push("&dp_1="+t);return r.join("")},this._determineOTPClientEnvironment=function(e){var t=r[e],n=C.Environments[C.environmentUtils.getCurrentEnvironment()];return C.OTP_FEATURE_TO_CONFIG[t].environmentToClientName[n]},this._isAppropriateLevel=function(e,t){var n=C.EaseCoreRestangular.all(C.TOKEN_CHECK_URL),r={level:e};return t&&(r.fallbackLevel=t),n.customGET("",r)},this.CHALLENGE_APP_BASE_URL=t.CHALLENGE_APP_BASE_URL,this.OTP_FEATURE_TO_CONFIG=t.OTP_FEATURE_TO_CONFIG,this.TOKEN_CHECK_URL=l.ktokenLevelCheck,this.Environments=E.Environments,this.OtpFeature=r}return e.$inject=["$window","OTP_CONFIG","EaseCoreRestangular","EaseConstantFactory","$q","EaseConstant","environmentUtils","pubsubService"],e}();t.OtpService=_,n.module("OtpModule").service("otpService",_)});
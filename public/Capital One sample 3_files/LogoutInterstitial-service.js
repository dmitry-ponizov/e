define(["require","exports","angular"],function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,o,n,i,a,r,s,l,u,c,g,h,d){this.EaseConstant=t,this.$ocLazyLoad=e,this.easeUIModalService=o,this.$state=n,this.messagingService=i,this.$q=a,this.EASEUtilsFactory=r,this.RoutingUtils=s,this.LogoutInterstitialConfigService=l,this._=u,this.$injector=c,this.InterstitialMessageService=g,this.$log=h,this.logoutInterstitialConstant=d}return t.prototype.getLogoutPageContext=function(){var t=this.$state.current.name,e=this._isCoreLogoutInterstitialState(t);if(e)return this.logoutInterstitialConstant.logoutPageContext.Core;var o=t?t.split("Details"):[];switch(o[0]){case this.EaseConstant.prefetchCreditCard:return this.logoutInterstitialConstant.logoutPageContext.Card;case this.EaseConstant.prefetchBank:return this.logoutInterstitialConstant.logoutPageContext.Bank;case this.EaseConstant.prefetchAutoLoan:return this.logoutInterstitialConstant.logoutPageContext.AutoLoan;default:return null}},t.prototype.launchFeatureModal=function(t){var e=this;this._getFeatureModalConfig(t).then(function(o){var n=t&&t.path?t.path.split("?").pop():null,i=e.RoutingUtils.getParams(n),a=o.component;return e.easeUIModalService.showModal({template:'<ease-ui-modal\n                    id="logoutInterstitial"\n                    modal-title="modalCtrl.message.headLine"\n                    icon-url="modalCtrl.message.iconUrl"\n                    modal-subtitle="modalCtrl.message.subheadLine"\n                    modal-bar="true"\n                    show-title-in-bar="true"\n                    close-modal="modalCtrl.closeModal()"\n                    back-button-options="modalCtrl.backButtonOptions"\n                    double-wide="modalCtrl.doubleWide">\n                        <'+a+'\n                        close-modal="modalCtrl.closeModal"\n                        back-button-options="modalCtrl.backButtonOptions"\n                        double-wide="modalCtrl.doubleWide"\n                        query-params="modalCtrl.queryParams">\n                        </'+a+">\n                    </ease-ui-modal>",controller:"LogoutInterstitialController as modalCtrl",inputs:{featureComponentConfig:o,message:t,queryParams:i}})},function(){return e._logout()})},t.prototype.launchInterstitialModal=function(){var t=this,e=this.getLogoutPageContext(),o=1,n=!0,i={BUS_EVT_ID:this.EaseConstant.busEvtId.respondToMessages,EVT_SYNCH_TOKEN:this.EASEUtilsFactory.generateSyncId()};return e?this._isCoreLogoutInterstitialState(this.$state.current.name)?this.InterstitialMessageService.addExternalInterstitialFiles().then(function(){t._handleInterstitialModal(e,i)})["catch"](function(e){t.$log.error(e)}):this.messagingService.getAccountData().then(function(a){var r=t.messagingService.getReferenceID(a.accounts,null,e,o,n).accountReferenceIds;return t.InterstitialMessageService.addExternalInterstitialFiles().then(function(){t._handleInterstitialModal(e,i,r)})})["catch"](function(e){t.$log.error(e)}):this.$q.reject()},t.prototype._isCoreLogoutInterstitialState=function(t){return t?this.logoutInterstitialConstant.coreLogoutInterstitialStates.some(function(e){return!!e.match(t)}):!1},t.prototype._getFeatureModalConfig=function(t){var e=this,o=t&&t.path?t.path.split("?").pop():null,n=this.RoutingUtils.getParams(o).feature,i=this.LogoutInterstitialConfigService.config.filter(function(t){return t.feature===n}).pop();return i&&i.dependencies&&i.component?this.$ocLazyLoad.load(i.dependencies).then(function(){var t=e._.camelCase(i.component)+"Directive",o=e._.camelCase(i.component)+"Component";return e.$injector.has(t)||e.$injector.has(o)?i:e.$q.reject("Error: could not find the component: "+i.component)}):this.$q.reject("Error: could not find a proper config object for "+n)},t.prototype._getLogoutInterstitialMessage=function(t,e,o){return this.messagingService.getLogoutInterstitialMessage(t,e,o)},t.prototype._isLogoutPath=function(t){var e=this._.get(t.buttons,"[1].link.path","");return"/logout"===e},t.prototype._handleInterstitialModal=function(t,e,o){var n=this;this._getLogoutInterstitialMessage(t,e,o).then(function(t){if(!t||!n._isLogoutPath(t))return n._logout();var e=!1;return n.InterstitialMessageService.openAngularInterstitial(t,e)},function(t){n.$log.warn("An error occurred in the _getLogoutInterstitialMessage method. The user will be logged out. Error Information: "+t),n._logout()})},t.prototype._logout=function(){this.$state.go("logout",{},{location:!1})},t.$inject=["EaseConstant","$ocLazyLoad","easeUIModalService","$state","messagingService","$q","EASEUtilsFactory","RoutingUtils","LogoutInterstitialConfigService","_","$injector","InterstitialMessageService","$log","logoutInterstitialConstant"],t}();o.module("LogoutInterstitialModule").service("LogoutInterstitialService",n)});
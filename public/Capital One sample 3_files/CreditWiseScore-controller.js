define(["require","exports","angular"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,i,n,r,a,s,o){this.i18nContent=e,this.EaseConstant=t,this.pubsubService=i,this.languagePreferencesFactory=n,this.CreditWiseWidgetService=r,this.EASEUtilsFactory=a,this.$element=s,this._=o,this.isCanada=a.isCanada()}return e.prototype.$postLink=function(){var e,t,i,n=this,r=this.$element.find("canvas")[0],a=r.width/2,s=r.height/2,o=6,l=s-o,c=.75*Math.PI,d=.25*Math.PI,h=!1,u=this.isCanada?this.EaseConstant.creditKeeper.colors:this.EaseConstant.creditWise.colors,C=!1,g=this.isCanada?this.EaseConstant.creditKeeper:this.EaseConstant.creditWise,f=741,p=300,v=this.isCanada?900:850,S=v-p,m=r.getContext("2d"),W=function(e,t,i,n,r){return m.beginPath(),m.arc(a,s,l,t,i,h),m.lineCap="round",m.lineWidth=n,m.strokeStyle=r,m.stroke(),m.lineWidth},b=function(t,i,r){var o=E(r),c=n._.filter(g,function(e){return r>=e.high}).sort(function(e,t){return e.low-t.low});c.push(o),e=n.i18nContent["ease.core.widget.creditwise."+o.desc+".label"].toUpperCase();for(var d=t,u=A(r),C=null,f=(u-t)/c.length,p=0;p<c.length;p++){var v=a+Math.cos(d)*l,S=a+Math.cos(d+f)*l,W=s+Math.sin(d)*l,b=s+Math.sin(d+f)*l;m.beginPath(),C=m.createLinearGradient(v,W,S,b),C.addColorStop(0,c[p].lowColor),C.addColorStop(1,c[p].highColor),m.strokeStyle=C,m.arc(a,s,l,d,u,h),m.lineWidth=i,m.stroke(),m.closePath(),d+=f}},y=function(t){var i=E(t);e=n.i18nContent["ease.core.widget.creditwise."+i.desc+".label"].toUpperCase();var r=m.createLinearGradient(0,100,80,90);return w(r,i)},w=function(e,t){return e.addColorStop(.25,t.lowColor),e.addColorStop(1,t.highColor),e},E=function(e){var t;for(var i in g)if(x(e,g[i])){t=g[i];break}return t},x=function(e,t){return t.low<=e&&t.high>=e},A=function(e){t=(e-p)/S;var i=1.5*t+.75;return i*Math.PI},I=function(e){return t=S-(e-p),i=.25*Math.PI-1.5/S*t*Math.PI},L=function(t){n.isCanada?b(c,4,t):W("Enrolled Credit Scpre Arc...",c,I(t),4,y(t));var i=function(e,t,i,n,r,a){var s=t.split(" "),o="",l=e.measureText(t).width>r?!0:!1;n=l?n+10:n+17;for(var c=0;c<s.length;c++){var d=(o+" "+s[c]).trim(),h=e.measureText(d),C=h.width;C>r&&c>0?(e.fillStyle=u.BLACK,e.fillText(o,i,n),o=s[c],n+=a):o=d}return e.fillStyle=u.BLACK,e.fillText(o,i,n),l},o=function(){r.style.letterSpacing="0px",m=r.getContext("2d"),m.textAlign="center",m.textBaseline="middle",m.font="200 12px Arial",C=i(m,e,a,s,r.width-26,12)},l=function(){r.style.letterSpacing="-2px",m=r.getContext("2d"),m.font="100 42px Arial",m.textAlign="center",m.textBaseline="middle";var e=C?s-12:s-8;m.fillText(t,a,e)};r.attributes["aria-label"].value=t+" "+e,r.attributes.role.value="img",o(),l(),n.$element[0].getElementsByClassName("widget-spinner-container")[0].classList.add("ng-hide"),n.$element[0].getElementsByClassName("creditWiseContain")[0].classList.remove("ng-hide")},D=function(){var e=new Image,t=n.isCanada?u.BLUE:y(f),i=n.isCanada?d:I(f);W("Unenrolled Credit Score Arc...",c,i,4,t),e.src=n.isCanada?n.EaseConstant.creditKeeperUnenrolledIcon:n.EaseConstant.creditWiseUnenrolledIcon,e.onload=function(){n.creditWiseData&&n.creditWiseData.enrolled||(n.isCanada?m.drawImage(e,20,s-e.height/2,85,35):m.drawImage(e,a-e.width/2,s-e.height/2),m.imageSmoothingQuality="high",n.$element[0].getElementsByClassName("widget-spinner-container")[0].classList.add("ng-hide"),n.$element[0].getElementsByClassName("creditWiseContain")[0].classList.remove("ng-hide"))}};this.alertIcon=this.EaseConstant.alertIconRed,this.CreditWiseWidgetService.getCreditScore().then(function(e){var t=n.isCanada?"creditkeeper":"creditwise";if(e){var i=e.enrolled?"enrolled":"unenrolled",a=e.eligibleForScoreRefresh?"refresh":"",s=(t+" "+i+" "+a).trim();n.pubsubService.pubsubTrackAnalytics({audienceType:s});var l=["cachedVantageScore","creditScore","eligibleForScoreRefresh","lastRefreshedDate","nextRefreshDate","enrolled"];n.creditWiseData={},l.forEach(function(t){n.creditWiseData[t]=e[t]})}else n.creditWiseData={enrolled:!1},n.pubsubService.pubsubTrackAnalytics({audienceType:t+" unenrolled"});if(n.contentData=n.CreditWiseWidgetService.getContent(),m.clearRect(0,0,r.width,r.height),W("Small Ring...",0,2*Math.PI,1,u.LIGHT_GRAY),W("Background Arc...",c,d,o,u.LIGHT_GRAY),n.creditWiseData&&n.creditWiseData.enrolled){var h=n.isCanada?n.creditWiseData.creditScore:n.creditWiseData.cachedVantageScore;L(h)}else D()})},e.prototype.launchCreditWise=function(){var e=this.isCanada?this.EaseConstant.creditKeeperUrl:this.EaseConstant.creditWiseUrl;this.pubsubService.pubsubTrackAnalytics({name:this.contentData.content.pubsubAnalyticsText}),window.open(e,"_blank").opener=null},e.prototype.getLang=function(){return this.languagePreferencesFactory.getCurrentLocale()},e.$inject=["i18nContent","EaseConstant","pubsubService","languagePreferencesFactory","CreditWiseWidgetService","EASEUtilsFactory","$element","_"],e}();t.CreditWiseScoreController=n,i.module("CreditWiseWidgetModule").controller("CreditWiseScoreController",n)});
define("AlertsModule",["require","angular"],function(e,t){"use strict";function r(e,t,r,a,n,o,i){var s={name:"alerts",url:"/alerts",pageViewObject:{levels:[i.pubsub.customersettingState,i.states.kAlerts]},resolve:{featureToggleData:["featureToggleFactory",function(e){return e.initializeFeatureToggleData()}],accountSummaryData:["summaryService",function(e){return e.getLobArray().length?e.get():e.set()}],urlChecking:["featureToggleData","$rootScope","EaseConstant","$location","ContentConstant","EASEUtilsFactory","summaryService","i18nContent","accountSummaryData",function(e,t,r,a,n,o,i,s,l){var c=i.getLobArray(),u=o.isShowAlerts(e,c),d={};return u||(d.msgHeader=s["core.common.snag.modal.header"],d.msgBody=s["core.common.snag.modal.featureoff.label"],t.$broadcast("error",d),a.path("/accountSummary")),!0}],profileInfoFactory:["$ocLazyLoad","$injector",function(e,t){return e.load({name:"personalInformationModule",serie:!0,files:[o.get("services",["CustomerSettings","PersonalInformation"]),o.get("controller",["CustomerSettings","PersonalInformation"]),o.get("directives",["CustomerSettings","PersonalInformation"])]}).then(function(){return t.get("profileInfoFactory")})}],phoneNumberData:["profileInfoFactory","summaryService","featureToggleData","EaseConstant",function(e,t,r,a){var n=t.getLobArray(),o=n.indexOf("coaf")>-1&&1===n.length,i=!0,s=void 0;if(r[a.features.enableShowPhone]&&r[a.features.enableEditPhone]&&!o)return e.getPhoneNumberList(a.busEvtId.alerts.getPhones,s,i).then(function(e){return e.errorIdString!==a.errorIdStrings.SUSPECTED_FRAUD&&e}).catch(function(){})}]},controller:"alertsController",controllerAs:"$ctrl",title:n["ease.common.alerts"],templateUrl:t.get("Alerts")};e.state(s),a.set("alerts.securityAlertModal",s,"/securityAlerts"),r.set("alerts.alertModal",s,"/:accountReferenceId")}function a(e,r,a,n){var o=this,i=this;this.buildAlertValues=function(e,t,r){var a=e.easeDisplayError||{};if(!_.isEmpty(a)&&a.displayMessage)return void("1"===a.severity&&r(function(){return t.showSnag(a)},0));var n=[];return e.entries&&e.entries.alertSubscription&&(n=e.entries.alertSubscription),{alerts:n}},this.securityAlertModal=function(t,r,n){e.state(t,{url:n,parent:r,pageViewObject:{levels:[a.pubsub.alertsModal.securityAlerts],lobs:a.pubsub.alertsModal.securityAlertsLob},resolve:{account:["summaryService","featureToggleData","_","EASEUtilsFactory",function(e,t,r,n){return e.get().then(function(o){if(o&&o.accounts){var i=e.getLobArray(),s=r.includes(i,"card");return t[a.features.enableDisplayCardAlerts]&&s?r.find(o.accounts,function(e){return n.isCardAccountOpen(e)}):null}return null})}],modalConfig:["account","alertsFactory","easeTemplates","$timeout","featureToggleData","$state","summaryService","_",function(e,t,n,i,s,l,c,u){var d=c.getLobArray(),p=u.includes(d,"card")||u.includes(d,"retail")||u.includes(d,"sbb");return s[a.features.enableDisplayAlerts]&&s[a.features.enableDisplayCustomerSecurityAlerts]&&s[a.features.enableEditCustomerSecurityAlerts]&&p?o.buildSecurityAlertsModalConfig(e,t,n,i):void l.go(r.name)}]},onEnter:["modalConfig","easeUIModalService","pubsubService","$state","EaseErrorMessageFactory","easeExceptionsService",function(e,t,a,n,o,i){if(e&&e.error){var s=o.getErrorMessage(e.error),l=!1;return i.displayErrorHandler(s.headerMessage,s.displayMessage,l),void n.go(r.name)}e&&t.showModal({templateUrl:e.templateUrl,controller:e.controller,inputs:e.inputs})}]})},this.buildSecurityAlertsModalConfig=function(e,t,r,a){return t.setLobOfAlert("customer"),t.getAlerts(e,"customer").then(function(i){var s=o.buildAlertValues(i,t,a);return{templateUrl:r.get("Alerts","","editSecurityAlertsModal"),controller:"editSecurityAlertsController",inputs:{customerAlertsArray:s.alerts,customerAccount:e,ContentConstant:n}}},function(e){return{error:e}})},t.extend(i,{set:function(e,t,r){this.securityAlertModal(e,t,r)}}),this.$get=function(){return i}}function n(e,r,a,n){var o=this,i=this;this.getAccountName=function(e,t){var r=e.accountNickname&&!/-- --/i.test(e.accountNickname)?e.accountNickname:e.originalProductName;return r+" ..."+t.trimAccountNumber(e.accountNumberTLNPI)},this.buildAlertValues=function(e,t,r){var a=e.easeDisplayError||{};if(!_.isEmpty(a)&&a.displayMessage)return void("1"===a.severity&&r(function(){return t.showSnag(a)},0));var n=[],o=[];return e.entries&&e.entries.alertSubscription&&(n=e.entries.alertSubscription),e.entries&&e.entries.securityAlertSubscription&&(o=e.entries.securityAlertSubscription),{alerts:n,securityAlerts:o}},this.buildCOAFAlertsModalConfig=function(e,t,r,a,n,o){return t.getAlerts(e,"coaf").then(function(t){return{templateUrl:r.get("Alerts","","editModal"),controller:"editAlertsController",inputs:{coafAccount:e,alertsArray:t}}},function(e){return{error:e}})},this.buildCardAlertsModalConfig=function(e,t,r,i,s){var l=i[a.features.enableDisplaySecurityAlerts]||!1,c=i[a.features.enableDisplayOsrAlerts];return t.setLobOfAlert("card"),t.getAlerts(e,"card").then(function(a){var i=o.buildAlertValues(a,t,s);return{templateUrl:r.get("Alerts","","editCardModal"),controller:"editCardAlertsController",inputs:{cardAccount:e,accountName:o.getAccountName(e,t),cardAlertsArray:i.alerts,securityAlertsArray:i.securityAlerts,viewSecurityAlerts:l,viewOsrAlerts:c,ContentConstant:n}}},function(e){return{error:e}})},this.buildBankAlertsModalConfig=function(e,t,r,i,s){var l=i[a.features.enableDisplayOsrAlerts];return t.setLobOfAlert("bank"),t.getAlerts(e,"bank").then(function(a){var i=o.buildAlertValues(a,t,s);return _.remove(i.alerts,function(e){return/OSRBNK/i.test(e.alertTypeCode)}),{templateUrl:r.get("Alerts","","editRetailModal"),controller:"editRetailAlertsController",inputs:{retailAccount:e,accountName:o.getAccountName(e,t),retailAlertsArray:i.alerts,viewOsrAlerts:l,ContentConstant:n}}},function(e){return{error:e}})},this.alertModal=function(t,r,n){e.state(t,{url:n,parent:r,resolve:{account:["summaryService","$stateParams",function(e,t){return e.get().then(function(e){return e&&e.accounts?_.find(e.accounts,function(e){return e.referenceId===t.accountReferenceId}):void 0})}],accountType:["account",function(e){var t={coaf:["AL"],card:["CC"],bank:["SA","DDA","MMA","CD"]};return e&&e.category?_.findKey(t,function(t){return _.indexOf(t,e.category)>-1}):void 0}],modalConfig:["account","alertsFactory","accountType","easeTemplates","featureToggleData","$timeout","$state","easeExceptionsService","EASEUtilsFactory",function(e,t,n,i,s,l,c,u,d){if(s[a.features.enableDisplayAlerts])switch(n){case"coaf":if(s[a.features.enableDisplayCoafAlerts]&&s[a.features.enableEditAlerts])return o.buildCOAFAlertsModalConfig(e,t,i,c,u,d);break;case"card":if(s[a.features.enableDisplayCardAlerts]&&s[a.features.enableEditCardAlerts])return o.buildCardAlertsModalConfig(e,t,i,s,l);break;case"bank":if(s[a.features.enableDisplayRetailAlerts]&&s[a.features.enableEditRetailAlerts])return o.buildBankAlertsModalConfig(e,t,i,s,l)}c.go(r.name)}]},onEnter:["accountType","modalConfig","easeUIModalService","$state","pubsubService","account","$timeout","easeExceptionsService","EaseErrorMessageFactory",function(e,t,n,o,i,s,l,c,u){if("undefined"==typeof s)return void o.go(r.name);if(t&&t.error){var d=o.current.data?o.current.data.stepStart:void 0;if(d)return void d.updateStep(a.kStepsStatus.error);var p=u.getErrorMessage(t.error),f=!1;return c.displayErrorHandler(p.headerMessage,p.displayMessage,f),void o.go(r.name)}var m=r.name===a.states.kAccountSummary,b=[a.pubsub.alertsModal.accountAlerts];m?(b=[a.pubsub.accountSummary,a.pubsub.alertsModal.steps,a.states.kAlerts],i.pageView({levels:b,lobs:e},!1)):i.pageView({levels:b,lobs:e},!0),t&&n.showModal({templateUrl:t.templateUrl,controller:t.controller,inputs:t.inputs})}]})},t.extend(i,{set:function(e,t,r){this.alertModal(e,t,r)}}),this.$get=function(){return i}}var o=t.module("AlertsModule",["EaseProperties","easeAppUtils","ContentProperties","i18nModule"]);return r.$inject=["$stateProvider","easeTemplatesProvider","alertModalStateProvider","securityAlertModalStateProvider","i18nContent","easeCoreFilesProvider","EaseConstant"],o.config(r),a.$inject=["$stateProvider","i18nContent","EaseConstant","ContentConstant"],n.$inject=["$stateProvider","i18nContent","EaseConstant","ContentConstant"],o.provider("alertModalState",n),o.provider("securityAlertModalState",a),o}),define("AlertsServices",["angular"],function(e){"use strict";function t(e,t,r,a,n,o,i,s,l){function c(e){var t=void 0;return e[0].eligibleContactPoints.contactPointSummary.some(function(e){return/eml/i.test(e.destinationType)&&/fld/i.test(e.contactPointStatus)?(t=e.alertDestination,!0):void 0}),t}function u(){return E}function d(e){E=e}function p(e){o.$broadcast("error",{msgHeader:e.headerMessage?e.headerMessage:i["core.common.snag.modal.header2"],msgBody:e.displayMessage})}function f(e,t){return a.get().then(function(r){var a=n.filter(r.accounts,function(r){return t?r.category===e&&r.subCategory===t:r.category===e});return a},function(e){throw e})}function m(e){return e.substring(e.length-4,e.length)}function b(e){var t={"Payment Due Reminder":{key:"reminder",order:0},"Payment has Posted":{key:"posted",order:1},"Payment was Rejected":{key:"rejected",order:2}},r=e.filter(function(e){return e.subscribedIndicator}).sort(function(e,r){return t[e.alertTypeCode].order-t[r.alertTypeCode].order}).map(function(e){return i["ease.core.bookend.alert.type."+t[e.alertTypeCode].key]}),a=s("easeHumanizeList")({list:r,lastSeparator:i["ease.common.and"]});return 0!==r.length?i["ease.core.bookend.alert.description.dynamic"].replace("{alertTypes}",a):i["ease.core.bookend.alert.description.noalert"]}function y(t,a){var n=t&&t.referenceId?encodeURIComponent(t.referenceId):"",o="coaf"===a||"bank"===a||"customer"===a?"":"&type="+t.accountUseType,i={BUS_EVT_ID:"customer"===a?"50240":"50091",EVT_SYNCH_TOKEN:e.getSyncId()};return l.one(r.kAlertsUrl+"/"+a+"?accountReferenceId="+n+o).customGET("",{},i).then(function(e){if("coaf"===a&&e.entries&&e.entries.alertSubscription){var t=A(e.entries.alertSubscription);return t}return e},function(e){throw e})}function g(e,t,a,n){var o=e&&e.referenceId?encodeURIComponent(e.referenceId):"",i={BUS_EVT_ID:"customer"===t?"50239":"50094",EVT_SYNCH_TOKEN:n};return l.one(r.kAlertsUrl+"/"+t+"?accountReferenceId="+o).customPOST(a,"",{},i).catch(function(e){throw e})}function A(e){return n.forEach(e,function(e){e.sendToContactPoints&&e.sendToContactPoints.contactPointSummary.length>0?e.subscribedIndicator=!0:e.subscribedIndicator=!1}),e}function C(e){return!!e[0].eligibleContactPoints&&1===n.filter(e[0].eligibleContactPoints.contactPointSummary,{destinationType:"EML"}).length}function h(t){var a={alertSubscription:t},n={BUS_EVT_ID:"50094",EVT_SYNCH_TOKEN:e.generateSyncId()},o=l.all(r.kAlertsUrl);return o.customPOST(a,"",{},n).catch(function(e){throw e})}function S(e){var t={phone:[],smsEnabled:!1},r=e&&e[0]&&e[0].eligibleContactPoints?e[0].eligibleContactPoints.contactPointSummary:[],a=n.filter(r,function(e){return/PHN/i.test(e.destinationType)&&/^ACT$|^UAS$|^ALL_TEXT$/i.test(e.contactPointStatus)});return 1===a.length?(t.phone=a[0],t.smsEnabled=!0):t.smsEnabled=!1,t}function v(e){var t=/Business/i.test(e.accountUseType)?r.kProfileSmallBusinessMobileUrl:r.kProfilePersonalMobileUrl;return t}var E;return{getAccountsWithAlerts:f,trimAccountNumber:m,generateCustomAlertContentMessage:b,getAlerts:y,postAlerts:g,updateAlertSubscriptions:h,isSmsEnabled:S,showSnag:p,showSendToPrimEmailText:C,getLobOfAlert:u,setLobOfAlert:d,checkForFailedEmailAddress:c,getErrorMessage:v}}var r=e.module("AlertsModule");return r.factory("alertsFactory",t),t.$inject=["EASEUtilsFactory","Restangular","EaseConstant","summaryService","_","$rootScope","i18nContent","$filter","EaseCoreRestangular"],r}),define("AlertsController",["angular"],function(e){function t(t,r,a,n,o,i,s,l,c,u,d,p,f,m,b,y){function g(e){return o.trimAccountNumber(e)}function A(e){return"account_"+D.trimAccountNumber(e)}function C(e){return e.accountNickname&&!/-- --/i.test(e.accountNickname)?e.accountNickname+" ..."+D.trimAccountNumber(e.accountNumberTLNPI):e.originalProductName+" ..."+D.trimAccountNumber(e.accountNumberTLNPI)}function h(e){D.retailArray=D.retailArray.concat(e)}function S(){return!!(D.coafArray&&v(D.coafArray)||D.cardArray&&v(D.cardArray)||D.retailArray&&v(D.retailArray))}function v(e){return e.some(function(e){return p.isAlertsClosed(e)})}function E(){return L?(D.disablePencilClick=!0,r.go(".securityAlertModal").finally(function(){D.disablePencilClick=!1})):void k()}function T(e){return N?(D.disablePencilClick=!0,r.go(".alertModal",{accountReferenceId:e.referenceId}).finally(function(){D.disablePencilClick=!1})):void k()}function I(e){return O?(D.disablePencilClick=!0,r.go(".alertModal",{accountReferenceId:e.referenceId}).finally(function(){D.disablePencilClick=!1})):void k()}function P(e){return M?(D.disablePencilClick=!0,r.go(".alertModal",{accountReferenceId:e.referenceId}).finally(function(){D.disablePencilClick=!1})):void k()}function k(){i.displayErrorHandler(n.defaultErrorMessage.msgHeader,m["core.common.snag.featureoff.short.label"])}function w(){return y&&y.mobile&&y.mobile.smsStatus&&e.isArray(y.mobile.smsStatus.reasons)&&e.isObject(y.mobile.smsStatus.reasons[0])&&U.indexOf(y.mobile.smsStatus.reasons[0].reasonCode)>-1}var D=this,M=t[n.features.enableEditAlerts],N=t[n.features.enableEditCardAlerts],O=t[n.features.enableEditRetailAlerts],$=(t[n.features.enableDisplaySecurityAlerts]||!1,t[n.features.enableDisplayOsrAlerts],t[n.features.enableDisplayCustomerSecurityAlerts]),L=t[n.features.enableEditCustomerSecurityAlerts],F=!1;D.disablePencilClick=!1,D.withHTML={closeAlert:!0,isCloseIcon:!1,alertIcon:!0,globalElementId:"Error",alertIconAria:"Alert Icon"};var U=[n.phoneReasonCodes.EXPIRED_VERIFICATION,n.phoneReasonCodes.PENDING_VERIFICATION,n.phoneReasonCodes.DISCONNECTED,n.phoneReasonCodes.INVALID],x=function(){i.displayErrorHandler(n.defaultErrorMessage.msgHeader,m["core.common.snag.featureoff.short.label"]),r.go("accountSummary")};if(t[n.features.enableDisplayAlerts]){var B=f.getLobArray(),R=d.includes(B,"card"),V=d.includes(B,"coaf"),_=d.includes(B,"retail"),q=d.includes(B,"sbb");F=R||_||q;var j={},H={};t[n.features.enableDisplayCoafAlerts]&&V&&(j.AL="coafArray"),t[n.features.enableDisplayCardAlerts]&&R&&(j.CC="cardArray"),t[n.features.enableDisplayRetailAlerts]&&(_||q)&&(D.retailArray=[],H.SA="SA",H.DDA="DDA",H.MMA="MMA",H.CD="CD");var X=Object.getOwnPropertyNames(j),K=Object.getOwnPropertyNames(H);X.length||K.length?(X.forEach(function(e){o.getAccountsWithAlerts(e).then(function(t){D[j[e]]=t})}),K.forEach(function(e){o.getAccountsWithAlerts(e,"retail").then(function(e){var t=e?e:[];h(t)})})):$||x()}else x();e.extend(D,{i18nContent:m,trimAccountNumber:g,getAccountName:C,getAccountId:A,openAlertsModal:P,openCardAlertsModal:T,openRetailAlertsModal:I,openSecurityAlertsModal:E,isShowAlert:p.isAlertsClosed,hasAlerts:S,hasMobileSmsReasonCode:w,viewCustomerSecurityAlerts:$&&F})}function r(t,r,a,n,o,i,s,l,c,u){function d(){return t.trimAccountNumber(i.accountNumberTLNPI)}function p(e){a.loadingCSS="ease_loading",s.pubsubTrackAnalytics({name:"update:button"}),t.updateAlertSubscriptions(e).then(function(r){f(o.kStepsStatus.completed,t.generateCustomAlertContentMessage(e)),a.updateError.closeAlert=!1}).catch(function(e){f(o.kStepsStatus.error),a.updateError.closeAlert=!0}).finally(function(){g&&g.updateStep||(a.loadingCSS="",a.updateError.closeAlert||a.close())})}function f(e,t){void 0===t&&(t=""),g&&g.updateStep&&g.updateStep(e,t)}function m(e){return e.replace(/ /g,"").toLowerCase()}function b(){a.loadingCSS||u.go("^")}function y(e){a.loadingCSS&&e.preventDefault()}var g=u.current.data?u.current.data.stepStart:void 0;a.updateError={closeAlert:!1,isCloseIcon:!1,alertIcon:!0,globalElementId:"Error",alertIconAria:"Alert Icon"},!g||g.currentStep&&g.currentStep.accountReferenceId||g.updateStep(this.EaseConstant.kStepsStatus.error);var A=c.$on("$stateChangeStart",r);a.$on("$destroy",function(){A()}),e.extend(a,{close:b,i18nContent:n,alertAccount:i,trimmedAccountNumber:d,submitAlerts:p,alertsArray:l,loadingCSS:"",generateIdentifier:m,checkBoxHandler:y,footerButton:g?g.footerButton:void 0})}function a(t,r,a,n,o,i,s,l,c,u,d,p,f,m,b,y){function g(){m.go("^")}function A(){v&&o.pubsubTrackAnalytics({name:"update:button"}),m.go("^")}function C(e){return!/onlstr/i.test(e.alertTypeCode)||f}function h(){o.pubsubTrackAnalytics({name:"alerts:update email:link"})}function S(){o.pubsubTrackAnalytics({name:"alerts:update phone:link"})}var v=!1,E=t.isSmsEnabled(i);a.phone=E.phone,a.showErrorMessage=!1;var T=t.showSendToPrimEmailText(i),I=t.checkForFailedEmailAddress(i),P={closeAlert:!0,iconColor:"#D03027",isCloseIcon:!1,alertIcon:!0,alertIconAria:n["ease.core.alertsprefs.modal.invalid.email.icon"]},k=a.$on("showGenericError",function(e,t){t.accountNumberTLNPI===s.accountNumberTLNPI&&(a.showErrorMessage=!0)});a.setDisableUpdate=function(e){v=!0,a.disableUpdate=e};var w=p.$on("$stateChangeStart",r);a.$on("$destroy",function(){w(),k()}),e.extend(a,{i18nContent:n,cardAlertAccount:s,accountName:l,cardAlertsArray:i,securityAlertsArray:c,loadingCSS:"",disableUpdate:!1,viewSecurityAlerts:u,closeModal:g,closeWithUpdatePubsub:A,smsEnabled:E.smsEnabled,displayAlert:C,showSendToPrimEmailText:T,errorOptions:P,failedEmailAddress:I,fireEmailPubsub:h,firePhonePubsub:S,messageOptions:{closeAlert:!0,isCloseIcon:!1,alertIcon:!0,globalElementId:"failedPhoneError",alertIconAria:n["ease.core.alertsprefs.modal.invalid.phone.icon"]},failedNumberLink:t.getErrorMessage(s)})}function n(t,r,a,n,o,i,s,l,c,u,d,p,f){function m(){y&&o.pubsubTrackAnalytics({name:"update:button"}),p.go("^")}function b(){o.pubsubTrackAnalytics({name:"alerts:update phone:link"})}var y=!1,g=t.isSmsEnabled(i),A={closeAlert:!0,iconColor:"#D03027",isCloseIcon:!1,alertIcon:!0,alertIconAria:n["ease.core.alertsprefs.modal.invalid.email.icon"]},C=a.$on("showGenericError",function(e,t){t.accountNumberTLNPI===s.accountNumberTLNPI&&(a.showErrorMessage=!0)}),h=t.showSendToPrimEmailText(i);a.phone=g.phone,a.setDisableUpdate=function(t){y=!0,a.disableUpdate=t,a.close=a.disableUpdate?e.noop:m};var S=u.$on("$stateChangeStart",r);a.$on("$destroy",function(){S(),C()}),e.extend(a,{close:r,i18nContent:n,retailAlertAccount:s,accountName:l,retailAlertsArray:i,loadingCSS:"",disableUpdate:!1,closeWithPubsub:m,smsEnabled:g.smsEnabled,showSendToPrimEmailText:h,errorOptions:A,firePhonePubsub:b,messageOptions:{closeAlert:!0,isCloseIcon:!1,alertIcon:!0,globalElementId:"failedPhoneError",alertIconAria:n["ease.core.alertsprefs.modal.invalid.phone.icon"]},failedNumberLink:t.getErrorMessage(s)})}function o(t,r,a,n,o,i,s,l,c,u,d,p,f){function m(){u.go("^")}function b(){C&&l.pubsubTrackAnalytics({name:"edit security alerts done:button"}),m()}function y(){var e=null;return p&&(e=r.getErrorMessage(p)),e}function g(){l.pubsubTrackAnalytics({name:"alerts:update email:link"})}function A(){l.pubsubTrackAnalytics({name:"alerts:update phone:link"})}var C=!1,h=r.isSmsEnabled(d);n.phone=h.phone;var S=r.showSendToPrimEmailText(d),v=r.checkForFailedEmailAddress(d),E={closeAlert:!0,iconColor:"#D03027",isCloseIcon:!1,alertIcon:!0,alertIconAria:i["ease.core.alertsprefs.modal.invalid.email.icon"]},T=n.$on("showGenericError",function(e,t){t.accountNumberTLNPI===p.accountNumberTLNPI&&(n.showErrorMessage=!0)});n.setDisableUpdate=function(e){C=!0,n.disableUpdate=e};var I=o.$on("$stateChangeStart",s);n.$on("$destroy",function(){I(),T()});var P=[{subscribedIndicator:!0,alertTypeDescription:i["ease.core.alertsprefs.securityalerts.editmodal.phone.label"],subscribableIndicator:!1,alertType:"c"},{subscribedIndicator:!0,alertTypeDescription:i["ease.core.alertsprefs.securityalerts.editmodal.address.label"],subscribableIndicator:!1,alertType:"c"}];e.extend(n,{close:s,i18nContent:i,customerAlertsArray:d,customerAlertAccount:p,closeModal:m,closeWithUpdatePubsub:b,staticAlertsArray:P,smsEnabled:h.smsEnabled,showSendToPrimEmailText:S,errorOptions:E,failedEmailAddress:v,fireEmailPubsub:g,firePhonePubsub:A,messageOptions:{closeAlert:!0,isCloseIcon:!1,alertIcon:!0,globalElementId:"failedPhoneError",alertIconAria:i["ease.core.alertsprefs.modal.invalid.phone.icon"]},failedNumberLink:y()})}function i(t,r,a,n,o,i,s,l,c,u,d){function p(e){T.errorStatus="error",T.errorMsg=e,F=!0}function f(e){return!isNaN(e)&&isFinite(e)}function m(){if(T.selectedItem===k)T.alert.alertFrequency.dailyFrequency.dailyIndicator=!0;else if(T.selectedItem===I){var e=w;T.alert.alertFrequency.weeklyFrequency.dayOfTheWeek=e.indexOf(T.nested.selectedItem)+1}else T.selectedItem===P?T.alert.alertFrequency.monthlyFrequency.dayOfTheMonth=T.nested.selectedItem:T.alert.alertFrequency.alertDaysInAdvance.alertDaysInAdvanceValue=T.selectedItem}function b(){1===T.options.length&&"alertDaysInAdvance"===T.options[0].type?T.alert.alertFrequency.alertDaysInAdvance={usableIndicator:!0}:(T.alert.alertFrequency.dailyFrequency={usableIndicator:!0},T.alert.alertFrequency.weeklyFrequency={usableIndicator:!0},T.alert.alertFrequency.monthlyFrequency={usableIndicator:!0})}function y(){a(function(){T.alert=e.copy(v.alert),T.shouldUseCurrencyInput?s[0].dispatchEvent(new CustomEvent("update-ease-input",{detail:{inputId:T.genIdForInput(),inputVal:v.inputValue||"0.00"}})):T.inputValue=v.inputValue,v.alert.alertTrigger.criteriaOperator&&"all"===v.alert.alertTrigger.criteriaOperator.toLowerCase()&&(T.readableInputOperator=E),N(v.selectedItem),M(v.nested.selectedItem),T.nested.items=v.nested.items,T.isNestedComponent=v.isNestedComponent,T.emailList=v.emailList},0)}function g(e){if(T.isOsr)return!0;if(T.alert.sendToContactPoints){var r=t.find(T.alert.sendToContactPoints.contactPointSummary,function(t){return t.destinationType===e});return!!r}return!1}function A(){return/ONLSTR/i.test(T.alert.alertTypeCode)?(T.alertTitle=T.content["ease.core.alertsprefs.cc.osralert.title"],!0):(T.alertTitle=T.alert.alertTypeDescription,!1)}function C(){if(/FRD2WY/i.test(T.alert.alertTypeCode)){var e=[];e[0]=T.alert;var t=r.isSmsEnabled(e);return!t.smsEnabled}return!1}function h(){var e,t,r,n=/DBTABX/i.test(T.alert.alertTypeCode),o=/CRDABX/i.test(T.alert.alertTypeCode),s={};n?(E=T.content["ease.core.alertsprefs.modal.dropdownoptions.debits.all"],e=T.content["ease.core.alertsprefs.modal.dropdownoptions.debits.equal"],t=T.content["ease.core.alertsprefs.modal.dropdownoptions.debits.above"],r=T.content["ease.core.alertsprefs.modal.dropdownoptions.debits.below"]):o&&(E=T.content["ease.core.alertsprefs.modal.dropdownoptions.credits.all"],e=T.content["ease.core.alertsprefs.modal.dropdownoptions.credits.equal"],t=T.content["ease.core.alertsprefs.modal.dropdownoptions.credits.above"],r=T.content["ease.core.alertsprefs.modal.dropdownoptions.credits.below"]),s[E]="all",s[e]="eq",s[t]="gt",s[r]="lt",T.alert.alertTrigger.criteriaOperator=T.alert.alertTrigger.criteriaOperator?T.alert.alertTrigger.criteriaOperator.toLowerCase():"all",T.readableInputOperator=function(){switch(T.alert.alertTrigger.criteriaOperator.toLowerCase()){case"all":return E;case"eq":return e;case"gt":return t;case"lt":return r;default:return E}}(),T.isTriggerDropdownOpen=!1,T.triggerDdItems=[],T.triggerOperators=Object.keys(s),T.triggerSelectFn=function(e){T.alert.alertTrigger.criteriaOperator!==s[e]&&(T.alert.alertTrigger.criteriaOperator=s[e],T.readableInputOperator=e,"all"===T.alert.alertTrigger.criteriaOperator?(T.inputValue=null,T.alert.alertTrigger.criteriaValue=void 0):T.inputValue||(T.inputValue="0.00",T.alert.alertTrigger.criteriaValue="0",a(function(){i[0].querySelector("#inputAlert_"+T.index).focus()})),(T.subscribedIndicatorEmail||T.subscribedIndicatorPhone)&&T.updateAlerts())},T.triggerDropdownCombobox={id:"alert_id"+T.index,placeholder:"",label:T.content["ease.core.alertsprefs.modal.dropdownoptions.aria"]}}function S(e,t){this.type=t,this.value=void 0,this.key=void 0,this.init=function(){switch(t){case"alertDaysInAdvance":this.key="alertDaysInAdvanceValue",this.value=e.hasOwnProperty(this.key)?e[this.key]:void 0;break;case"dailyFrequency":this.key="dailyIndicator",this.option=k,this.value=e.hasOwnProperty(this.key)?e[this.key]:void 0;break;case"weeklyFrequency":this.key="dayOfTheWeek",this.option=I,this.value=e.hasOwnProperty(this.key)?e[this.key]:void 0;break;case"monthlyFrequency":this.key="dayOfTheMonth",this.option=P,this.value=e.hasOwnProperty(this.key)?e[this.key]:void 0}},this.init()}var v,E,T=this,I=c["ease.core.transfer.frequency.weekly"],P=c["ease.core.transfer.frequency.monthly"],k=c["ease.common.daily"],w=[c["ease.core.transfer.form.day.2nd.aria.label"],c["ease.core.transfer.form.day.3rd.aria.label"],c["ease.core.transfer.form.day.4th.aria.label"],c["ease.core.transfer.form.day.5th.aria.label"],c["ease.core.transfer.form.day.6th.aria.label"],c["ease.core.transfer.form.day.7th.aria.label"],c["ease.core.transfer.form.day.1st.aria.label"]],D=["SA","DDA","MMA","CD"],M=function(e){T.nested.tempSelectedItem=e,T.nested.selectedItem=e},N=function(e){T.tempSelectedItem=e,T.selectedItem=e},O=/Email/i;T.selectedFrequency={},T.nested={isOpen:!1,items:[],selected:function(e){e&&T.nested.tempSelectedItem!==e&&(M(e),T.alert.subscribedIndicator&&T.updateAlerts())},data:{id:"alert_nested_id"+T.index,placeholder:"",label:T.content["ease.core.alertsprefs.summarysendday.aria"]}},N(""),T.isNestedComponent=!1,T.populatedNested=function(e){T.isNestedComponent=!0,e===I?T.nested.items=w:e===P&&(T.nested.items=t.range(1,29)),M(T.nested.items[0])},T.options=function(){var e=[],t=T.alert.alertFrequency;return t&&Object.getOwnPropertyNames(t).forEach(function(r){if(t[r].usableIndicator){var a=new S(t[r],r);if(e.push(a),a.value)if("alertDaysInAdvanceValue"===a.key)N(a.value);else if(N(a.option),a.option===I){T.populatedNested(a.option);var n=w;M(n[a.value-1])}else a.option===P&&(T.populatedNested(a.option),M(a.value))}}),e}(),T.shouldUseCurrencyInput=T.account&&t.includes(D,T.account.category)&&!/CKPOST/i.test(T.alert.alertTypeCode),T.inputBoxLength=T.shouldUseCurrencyInput?16:12,T.charLimit=T.shouldUseCurrencyInput?12:30,T.isAlertTrigger=T.alert.alertTrigger&&T.alert.alertTrigger.usableIndicator||!1,T.hasCriteriaOperator=/DBTABX/i.test(T.alert.alertTypeCode)||/CRDABX/i.test(T.alert.alertTypeCode),T.alertLabel=T.alert.alertTypeDescription,T.shouldShowTriggerInputField=function(){var e;if(T.hasCriteriaOperator){var t=void 0===T.alert.alertTrigger.criteriaOperator||"all"===T.alert.alertTrigger.criteriaOperator;e=!(T.alert.alertTrigger&&t)}else e=T.alert.alertTrigger&&T.alert.alertTrigger.usableIndicator&&!/BLSBNK/i.test(T.alert.alertTypeCode);return e},T.inputValue=T.alert.alertTrigger&&T.alert.alertTrigger.criteriaValue&&T.alert.alertTrigger.criteriaValue>=0?T.alert.alertTrigger.criteriaValue:void 0,T.isAlertFrequency=!t.isEmpty(T.options)&&!/BLSBNK/i.test(T.alert.alertTypeCode),T.isAccountAlert="A"===T.alert.alertType,T.isSecurityAlert="S"===T.alert.alertType,T.isCustomerAlert="C"===T.alert.alertType,T.isCustomerStaticAlert="c"===T.alert.alertType,T.subscribableIndicator=!T.alert.subscribableIndicator,T.ddItems=[],T.emailCheckboxAriaLabel=T.alert.alertTypeDescription+" "+T.content["ease.common.email"],T.smsCheckboxAriaLabel=T.alert.alertTypeDescription+" "+T.content["ease.core.profileprefs.alerts.editmodal.sms.label"];var $=function(){T.showEditLink=(T.subscribedIndicatorEmail||T.subscribableIndicator)&&T.emailList.length>1&&!T.drawerOpened};T.drawerOpened=!1,T.showMultiEmails=function(){return!T.isOsr&&T.showEditLink},T.displayEmailText=function(){return T.getSendToEmailList().length>1?T.content["ease.core.alertsprefs.modal.email.multmsg2"]:T.content["ease.common.email"]},T.isShowDrawer=function(){return!T.isOsr&&T.emailList.length>1},T.getErrorStatusIndex=function(e){return 10*T.index+e};var L;T.onInit=function(){T.isAlertFrequency&&(T.isOpen=!1,1===T.options.length&&"alertDaysInAdvance"===T.options[0].type?T.items=[5,7,10]:T.items=T.options.map(function(e){return e.option}),T.alert.subscribedIndicator||(N(T.items[0]),T.isNestedComponent=!1),T.data={id:"alert_id"+T.index,placeholder:"",label:T.genLabel()}),T.hasCriteriaOperator&&h(),a(function(){v=e.copy(T)},0),T.isOsr=A(),T.shouldHideTextCheckbox=T.isOsr||/OSRBNK/i.test(T.alert.alertTypeCode)||C()||T.isCustomerStaticAlert,T.subscribedIndicatorPhone=!!T.alert.subscribedIndicator&&g("PHN"),T.subscribedIndicatorEmail=!!T.alert.subscribedIndicator&&g("EML"),T.alert.sendToContactPoints||(T.alert.sendToContactPoints={contactPointSummary:[]}),T.alert.eligibleContactPoints||(T.alert.eligibleContactPoints={contactPointSummary:[]}),/BLSBNK/i.test(T.alert.alertTypeCode)&&(T.isNestedComponent=!1),T.eligibleEmails=t.filter(T.alert.eligibleContactPoints.contactPointSummary,{destinationType:"EML"}),T.emailList=t.sortBy(e.copy(T.eligibleEmails),function(e){return e.primaryInd===!0?(e.checked=!0,0):1}),T.emailList.forEach(function(e){T.alert.sendToContactPoints.contactPointSummary.forEach(function(t){e.alertDestination===t.alertDestination&&(e.checked=!0)})}),a(function(){v=e.copy(T)},0),L=n.$on("showEditLinkEvt",function(e,t){T.drawerOpened&&(t.index!==T.index||t.index===T.index&&t.type!==T.alert.alertType)&&(T.drawerOpened=!1,i[0].dispatchEvent(new CustomEvent("toggle-drawer",{detail:{actionType:"close",drawerId:"drawer"+T.alert.alertType+T.index},bubbles:!0,cancelable:!0}))),$()}),$()},T.i18=c,T.selected=function(e){e&&T.tempSelectedItem!==e&&(N(e),M(""),e===I||e===P?T.populatedNested(e):T.isNestedComponent=!1,T.alert.subscribedIndicator&&T.updateAlerts())},T.genIdForInput=function(){return"inputAlert_"+T.index},T.genLabel=function(){switch(T.alert.alertTypeCode){case"TRXABX":return T.content["ease.core.alertsprefs.hightrans.aria"];case"BALABX":return T.content["ease.core.alertsprefs.highbal.aria"];case"AVCRLX":return T.content["ease.core.alertsprefs.closetolimit.aria"];case"PAYDUE":return T.content["ease.core.alertsprefs.paymentdue.aria"];case"BALSUM":return T.content["ease.core.alertsprefs.summaryfreq.aria"];case"CKPOST":return T.content["ease.core.alertsprefs.checkposted.aria"];case"BAXBNK":return T.content["ease.core.alertsprefs.balanceabove.aria"];case"BALBEX":return T.content["ease.core.alertsprefs.balancebelow.aria"];case"DBTABX":return T.content["ease.core.alertsprefs.transactionfilter.aria"];case"CRDABX":return T.content["ease.core.alertsprefs.transactionfilter.aria"];case"BLSBNK":return T.content["ease.core.alertsprefs.summaryfreq.aria"]}};var F=!1;T.resetErrorStatus=function(e){n.$evalAsync(function(){T.errorStatus="",T.errorMsg="",e||T.alert.subscribedIndicator&&!T.inputValue&&(T.shouldUseCurrencyInput?s[0].dispatchEvent(new CustomEvent("update-ease-input",{detail:{inputId:T.genIdForInput(),inputVal:T.alert.alertTrigger.criteriaValue&&T.alert.alertTrigger.criteriaValue>0?T.alert.alertTrigger.criteriaValue:void 0}})):T.inputValue=T.alert.alertTrigger.criteriaValue&&T.alert.alertTrigger.criteriaValue>0?T.alert.alertTrigger.criteriaValue:void 0)})},T.checkBeforeResettingErrorStatus=function(){F?F=!1:T.resetErrorStatus()};var U=function(n){var o=n.easeDisplayError||{};!t.isEmpty(o)&&o.displayMessage?("1"===o.severity?r.showSnag(o):"2"===o.severity&&a(function(){var e=c[o.displayMessage]?c[o.displayMessage]:o.displayMessage;p(e)},100),y()):v=e.copy(T)},x=function(e){T.emailList.forEach(function(t){t.checked=e})};T.emailCheckBoxClickHandler=function(e,t){u.pubsubTrackAnalytics({name:T.alert.alertTypeDescription+" add alert second email:button"}),T.subscribedIndicatorEmail=T.getSendToEmailList().length>0,T.updateAlerts(t),e&&e.stopPropagation()};var B=function(){var e=["TRXABX","BALABX","AVCRLX"];return e.indexOf(T.alert.alertTypeCode)>-1};T.checkBoxHandler=function(e,t){if(!/BLSBNK/i.test(T.alert.alertTypeCode)&&T.isAlertTrigger&&"all"!==T.alert.alertTrigger.criteriaOperator&&T["subscribedIndicator"+t]&&(!T.inputValue||B()&&!this.validateInput()))return p(T.content["ease.core.profileprefs.alerts.editmodal.missingvalue.error"]),void(T["subscribedIndicator"+t]=!1);O.test(t)?(u.pubsubTrackAnalytics({
name:T.alert.alertTypeDescription+" add alert email:button"}),T.openDrawer(T.index,!T["subscribedIndicator"+t],T.alert.alertType),x(T["subscribedIndicator"+t])):u.pubsubTrackAnalytics({name:T.alert.alertTypeDescription+" add alert text:button"});var r=e.target.checked;r&&B()&&!this.validateInput()||T.updateAlerts(t)};var R=function(){return t.filter(T.alert.sendToContactPoints.contactPointSummary,function(e){return!/EML/i.test(e.destinationType)})};T.updateAlerts=function(e){e&&!T.isOsr?T["subscribedIndicator"+e]?(T.alert.subscribedIndicator=!0,O.test(e)?(T.alert.sendToContactPoints.contactPointSummary=R(),T.alert.sendToContactPoints.contactPointSummary=T.alert.sendToContactPoints.contactPointSummary.concat(T.getSendToEmailList())):T.alert.sendToContactPoints.contactPointSummary.push(T["get"+e])):(O.test(e)?T.alert.sendToContactPoints.contactPointSummary=R():T.alert.sendToContactPoints.contactPointSummary=t.filter(T.alert.sendToContactPoints.contactPointSummary,function(t){return t.alertDestination!==T["get"+e].alertDestination}),T.alert.subscribedIndicator=T.alert.sendToContactPoints.contactPointSummary.length>0):T.isOsr&&(T.alert.subscribedIndicator=T.subscribedIndicatorEmail),T.isAlertFrequency&&(b(),(e&&T["subscribedIndicator"+e]||T.alert.subscribedIndicator)&&m()),T.setDisableUpdate(!0);var a="\\"+l.NUMBER_FORMATS.GROUP_SEP,n=new RegExp(a,"g"),i=0,s=d.getSyncId();T.shouldUseCurrencyInput&&T.alert.alertTrigger.criteriaValue&&(i=new String(T.alert.alertTrigger.criteriaValue),T.alert.alertTrigger.criteriaValue=i.replace(n,"")),r.postAlerts(T.account,r.getLobOfAlert(),T.alert,s).then(U,function(){T.setDisableUpdate(!1),o.$broadcast("showGenericError",T.account)}).finally(function(){T.setDisableUpdate(!1)})},T.openDrawer=function(e,t,r){o.$broadcast("showEditLinkEvt",{index:e,type:r}),t||(T.drawerOpened=!0,i[0].dispatchEvent(new CustomEvent("toggle-drawer",{detail:{actionType:"open",drawerId:"drawer"+T.alert.alertType+e},bubbles:!0,cancelable:!0})),$())},T.getSendToEmailList=function(){return t.filter(T.emailList,{checked:!0})},T.validateInput=function(){T.errorStatus="",T.errorMsg="";var e;if("string"==typeof T.inputValue){var t=T.inputValue?T.inputValue.replace(/,/g,""):null;e=f(t)?parseInt(t):null}else e=T.inputValue;if(T.alert.subscribedIndicator){if(!e&&0!==e)return a(function(){p(T.content["ease.core.profileprefs.alerts.editmodal.missingvalue.error"])},0),!1;if(B()&&1>e)return a(function(){p(T.content["ease.core.profileprefs.alerts.editmodal.minimumvaluerequired.error"])},0),!1;T.alert.alertTrigger.criteriaValue!==e&&(T.alert.alertTrigger.criteriaValue=e,T.updateAlerts())}else if(T.alert.alertTrigger.criteriaValue=e,B()&&1>e)return a(function(){p(T.content["ease.core.profileprefs.alerts.editmodal.minimumvaluerequired.error"])},0),!1;return!0},n.$on("$destroy",function(){L()}),T.onInit()}e.module("AlertsModule").controller("alertsController",t).controller("editAlertsController",r).controller("editCardAlertsController",a).controller("editRetailAlertsController",n).controller("editSecurityAlertsController",o).controller("alertRowController",i),t.$inject=["featureToggleData","$state","$rootScope","EaseConstant","alertsFactory","easeExceptionsService","ContentConstant","easeUIModalService","easeTemplates","pubsubService","_","EASEUtilsFactory","summaryService","i18nContent","$timeout","phoneNumberData"],r.$inject=["alertsFactory","close","$scope","i18nContent","EaseConstant","coafAccount","pubsubService","alertsArray","$rootScope","$state"],a.$inject=["alertsFactory","close","$scope","i18nContent","pubsubService","cardAlertsArray","cardAccount","accountName","securityAlertsArray","viewSecurityAlerts","_","$rootScope","viewOsrAlerts","$state","ContentConstant","EaseConstant"],n.$inject=["alertsFactory","close","$scope","i18nContent","pubsubService","retailAlertsArray","retailAccount","accountName","_","$rootScope","ContentConstant","$state","EaseConstant"],o.$inject=["_","alertsFactory","$timeout","$scope","$rootScope","i18nContent","close","pubsubService","ContentConstant","$state","customerAlertsArray","customerAccount","EaseConstant"],i.$inject=["_","alertsFactory","$timeout","$scope","$rootScope","$element","$document","$locale","i18nContent","pubsubService","EASEUtilsFactory"]}),define("AlertsDirectives",["angular"],function(e){"use strict";function t(e){return{restrict:"A",link:function(t,r,a){t.$watch(a.focusCardAlertEmailList,function(t){t&&e(function(){r[0].focus()},100)})}}}function r(){return{restrict:"A",controller:["$element",function(e){var t=this;t.resetErrorDirectiveElements={},t.isSorted=!1,t.setAllTextInputNodes=function(){t.allTextInputNodes=e[0].getElementsByTagName("ease-input")},t.sortElements=function(){t.sortedElements=[];for(var e=Object.keys(t.resetErrorDirectiveElements).sort(function(e,t){return e-t}),r=0,a=e.length;a>r;r++)t.sortedElements.push(t.resetErrorDirectiveElements[e[r]])}}]}}function a(t,r,a){return{restrict:"A",require:"^^parentResetErrorStatus",link:{pre:function(e,t,r,a){var n=r.resetAlertErrorStatus;a.resetErrorDirectiveElements[n]=t[0],a.isSorted=!1},post:function(n,o,i,s){function l(){r.forEach(s.allTextInputNodes,function(t){p=e.element(t),f=p.controller("alertRow"),"checkbox"===o[0].type?c():u()})}function c(){(f!==o.controller("alertRow")||f.inputValue||f.alert.subscribedIndicator)&&f.resetErrorStatus()}function u(){o.find("input")[0]===p.find("input")[0]?f.resetErrorStatus(!0):f.checkBeforeResettingErrorStatus()}function d(t){m=s.sortedElements.indexOf(o[0]),r.forEach(s.allTextInputNodes,function(r){p=e.element(r),b=s.sortedElements.indexOf(p[0]),f=p.controller("alertRow");var n=t.keyCode||t.which||t.charCode;if(n!==a.keyCodes.SHIFT)if(o.find("input")[0]===p.find("input")[0]){if(n===a.keyCodes.BACKSPACE||n===a.keyCodes.TAB||n===a.keyCodes.SHIFT)return}else m===b-1&&!t.shiftKey&&n===a.keyCodes.TAB||m===b+1&&t.shiftKey&&n===a.keyCodes.TAB?f.resetErrorStatus(!0):f.resetErrorStatus()})}t(function(){s.isSorted||(s.sortElements(),s.setAllTextInputNodes(),s.isSorted=!0)});var p,f,m,b;o.on("click",l),o.on("keydown",d),n.$on("$destroy",function(){o.off("click",l),o.off("keydown",d)})}}}}var n=e.module("AlertsModule");n.directive("alertRow",[function(){return{restrict:"E",templateUrl:"/ease-ui/dist/features/Alerts/html/Alert-fields.html",bindToController:!0,controller:"alertRowController",controllerAs:"rowCtrl",scope:{alert:"=",index:"@idx",account:"=",content:"=",getPhone:"=",smsEnabled:"=",totalAlerts:"@",setDisableUpdate:"&",close:"&"}}}]),t.$inject=["$timeout"],n.directive("focusCardAlertEmailList",t),n.directive("validateAlertInput",function(){return{restrict:"A",require:"^^alertRow",link:function(t,r,a,n){var o=e.element(r.find("input"));o.on("blur",function(){n.validateInput()})}}}),n.directive("parentResetErrorStatus",r),a.$inject=["$timeout","_","EaseConstant"],n.directive("resetAlertErrorStatus",a)}),define("AlertsBundle",["AlertsModule","AlertsServices","AlertsController","AlertsDirectives"],function(){}),require(["AlertsBundle"]);